{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _setTimeout from \"@babel/runtime-corejs3/core-js-stable/set-timeout\";import _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport { styled, SuperChart, t, Behavior } from '@superset-ui/core';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport { getChartDataRequest } from 'src/chart/chartAction';\nimport Loading from 'src/components/Loading';\nimport BasicErrorAlert from 'src/components/ErrorMessage/BasicErrorAlert';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { waitForAsyncData } from 'src/middleware/asyncEvent';\nimport { getFormData } from '../../utils';\nimport { useCascadingFilters } from './state';import { jsx as ___EmotionJSX } from \"@emotion/core\";\nconst FilterItem = styled.div`\n  min-height: ${({ theme }) => theme.gridUnit * 11}px;\n  padding-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n`;\nconst FilterValue = ({ filter, directPathToChild, onFilterSelectionChange }) => {\n  const { id, targets, filterType } = filter;\n  const cascadingFilters = useCascadingFilters(id);\n  const [state, setState] = useState([]);\n  const [error, setError] = useState('');\n  const [formData, setFormData] = useState({});\n  const inputRef = useRef(null);\n  const [target] = targets;\n  const { datasetId, column = {} } = target;\n  const { name: groupby } = column;\n  const hasDataSource = !!datasetId;\n  const [loading, setLoading] = useState(hasDataSource);\n  useEffect(() => {\n    const newFormData = getFormData({\n      ...filter,\n      datasetId,\n      cascadingFilters,\n      groupby,\n      inputRef });\n\n    if (!areObjectsEqual(formData, newFormData)) {\n      setFormData(newFormData);\n      if (!hasDataSource) {\n        return;\n      }\n      getChartDataRequest({\n        formData: newFormData,\n        force: false,\n        requestParams: { dashboardId: 0 } }).\n\n      then(response => {\n        if (isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) {\n          // deal with getChartDataRequest transforming the response data\n          const result = 'result' in response ? response.result[0] : response;\n          waitForAsyncData(result).\n          then(asyncResult => {\n            setLoading(false);\n            setState(asyncResult);\n          }).\n          catch(error => {\n            setError(error.message || error.error || t('Check configuration'));\n            setLoading(false);\n          });\n        } else\n        {\n          setState(response.result);\n          setError('');\n          setLoading(false);\n        }\n      }).\n      catch(error => {\n        setError(error.statusText);\n        setLoading(false);\n      });\n    }\n  }, [\n  cascadingFilters,\n  datasetId,\n  groupby,\n  _JSON$stringify(filter),\n  hasDataSource]);\n\n  useEffect(() => {\n    if ((directPathToChild == null ? void 0 : directPathToChild[0]) === filter.id) {\n      // wait for Cascade Popover to open\n      const timeout = _setTimeout(() => {var _inputRef$current;\n        inputRef == null ? void 0 : (_inputRef$current = inputRef.current) == null ? void 0 : _inputRef$current.focus();\n      }, 200);\n      return () => clearTimeout(timeout);\n    }\n    return undefined;\n  }, [inputRef, directPathToChild, filter.id]);\n  const setDataMask = dataMask => onFilterSelectionChange(filter, dataMask);\n  if (error) {\n    return ___EmotionJSX(BasicErrorAlert, { title: t('Cannot load filter'), body: error, level: \"error\" });\n  }\n  return ___EmotionJSX(FilterItem, { \"data-test\": \"form-item-value\" },\n  loading ? ___EmotionJSX(Loading, { position: \"inline-centered\" }) : ___EmotionJSX(SuperChart, { height: 20, width: 220, formData: formData\n    // For charts that don't have datasource we need workaround for empty placeholder\n    , queriesData: hasDataSource ? state : [{ data: [{}] }], chartType: filterType, behaviors: [Behavior.NATIVE_FILTER], hooks: { setDataMask } }));\n\n};__signature__(FilterValue, \"useCascadingFilters{cascadingFilters}\\nuseState{[state, setState]([])}\\nuseState{[error, setError]('')}\\nuseState{[formData, setFormData]({})}\\nuseRef{inputRef}\\nuseState{[loading, setLoading](hasDataSource)}\\nuseEffect{}\\nuseEffect{}\", () => [useCascadingFilters]);const _default =\nFilterValue;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(FilterItem, \"FilterItem\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterValue.tsx\");reactHotLoader.register(FilterValue, \"FilterValue\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterValue.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterValue.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterValue.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport {\n  QueryFormData,\n  styled,\n  SuperChart,\n  DataMask,\n  t,\n  Behavior,\n  ChartDataResponseResult,\n} from '@superset-ui/core';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport { getChartDataRequest } from 'src/chart/chartAction';\nimport Loading from 'src/components/Loading';\nimport BasicErrorAlert from 'src/components/ErrorMessage/BasicErrorAlert';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { waitForAsyncData } from 'src/middleware/asyncEvent';\nimport { ClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { FilterProps } from './types';\nimport { getFormData } from '../../utils';\nimport { useCascadingFilters } from './state';\n\nconst FilterItem = styled.div`\n  min-height: ${({ theme }) => theme.gridUnit * 11}px;\n  padding-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n`;\n\nconst FilterValue: React.FC<FilterProps> = ({\n  filter,\n  directPathToChild,\n  onFilterSelectionChange,\n}) => {\n  const { id, targets, filterType } = filter;\n  const cascadingFilters = useCascadingFilters(id);\n  const [state, setState] = useState<ChartDataResponseResult[]>([]);\n  const [error, setError] = useState<string>('');\n  const [formData, setFormData] = useState<Partial<QueryFormData>>({});\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [target] = targets;\n  const {\n    datasetId,\n    column = {},\n  }: Partial<{ datasetId: number; column: { name?: string } }> = target;\n  const { name: groupby } = column;\n  const hasDataSource = !!datasetId;\n  const [loading, setLoading] = useState<boolean>(hasDataSource);\n  useEffect(() => {\n    const newFormData = getFormData({\n      ...filter,\n      datasetId,\n      cascadingFilters,\n      groupby,\n      inputRef,\n    });\n    if (!areObjectsEqual(formData, newFormData)) {\n      setFormData(newFormData);\n      if (!hasDataSource) {\n        return;\n      }\n      getChartDataRequest({\n        formData: newFormData,\n        force: false,\n        requestParams: { dashboardId: 0 },\n      })\n        .then(response => {\n          if (isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) {\n            // deal with getChartDataRequest transforming the response data\n            const result = 'result' in response ? response.result[0] : response;\n            waitForAsyncData(result)\n              .then((asyncResult: ChartDataResponseResult[]) => {\n                setLoading(false);\n                setState(asyncResult);\n              })\n              .catch((error: ClientErrorObject) => {\n                setError(\n                  error.message || error.error || t('Check configuration'),\n                );\n                setLoading(false);\n              });\n          } else {\n            setState(response.result);\n            setError('');\n            setLoading(false);\n          }\n        })\n        .catch((error: Response) => {\n          setError(error.statusText);\n          setLoading(false);\n        });\n    }\n  }, [\n    cascadingFilters,\n    datasetId,\n    groupby,\n    JSON.stringify(filter),\n    hasDataSource,\n  ]);\n\n  useEffect(() => {\n    if (directPathToChild?.[0] === filter.id) {\n      // wait for Cascade Popover to open\n      const timeout = setTimeout(() => {\n        inputRef?.current?.focus();\n      }, 200);\n      return () => clearTimeout(timeout);\n    }\n    return undefined;\n  }, [inputRef, directPathToChild, filter.id]);\n\n  const setDataMask = (dataMask: DataMask) =>\n    onFilterSelectionChange(filter, dataMask);\n\n  if (error) {\n    return (\n      <BasicErrorAlert\n        title={t('Cannot load filter')}\n        body={error}\n        level=\"error\"\n      />\n    );\n  }\n\n  return (\n    <FilterItem data-test=\"form-item-value\">\n      {loading ? (\n        <Loading position=\"inline-centered\" />\n      ) : (\n        <SuperChart\n          height={20}\n          width={220}\n          formData={formData}\n          // For charts that don't have datasource we need workaround for empty placeholder\n          queriesData={hasDataSource ? state : [{ data: [{}] }]}\n          chartType={filterType}\n          behaviors={[Behavior.NATIVE_FILTER]}\n          hooks={{ setDataMask }}\n        />\n      )}\n    </FilterItem>\n  );\n};\n\nexport default FilterValue;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}