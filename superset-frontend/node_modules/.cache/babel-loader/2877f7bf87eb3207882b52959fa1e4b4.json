{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getChartMetadataRegistry, Behavior } from '@superset-ui/core';\nexport const getFormData = ({ datasetId, cascadingFilters = {}, groupby, currentValue, inputRef, defaultValue, controlValues, filterType }) => {\n  const otherProps = {};\n  if (datasetId) {\n    otherProps.datasource = `${datasetId}__table`;\n  }\n  if (groupby) {\n    otherProps.groupby = [groupby];\n  }\n  return {\n    ...controlValues,\n    ...otherProps,\n    adhoc_filters: [],\n    extra_filters: [],\n    extra_form_data: cascadingFilters,\n    granularity_sqla: 'ds',\n    metrics: ['count'],\n    row_limit: 10000,\n    showSearch: true,\n    currentValue,\n    defaultValue,\n    time_range: 'No filter',\n    time_range_endpoints: ['inclusive', 'exclusive'],\n    url_params: {},\n    viz_type: filterType,\n    inputRef };\n\n};\nexport function mergeExtraFormData(originalExtra = {}, newExtra) {\n  const { override_form_data: originalOverride = {}, append_form_data: originalAppend = {} } = originalExtra;\n  const { override_form_data: newOverride = {}, append_form_data: newAppend = {}, custom_form_data: newCustom = {} } = newExtra;\n  const appendKeys = new _Set([\n  ..._Object$keys(originalAppend),\n  ..._Object$keys(newAppend)]);\n\n  const appendFormData = {};\n  _forEachInstanceProperty(appendKeys).call(appendKeys, key => {\n    appendFormData[key] = [\n    // @ts-ignore\n    ...((originalAppend == null ? void 0 : originalAppend[key]) || []),\n    // @ts-ignore\n    ...((newAppend == null ? void 0 : newAppend[key]) || [])];\n\n  });\n  return {\n    custom_form_data: newCustom,\n    override_form_data: {\n      ...originalOverride,\n      ...newOverride },\n\n    append_form_data: appendFormData };\n\n}\nexport function isCrossFilter(vizType) {var _getChartMetadataRegi, _getChartMetadataRegi2;\n  // @ts-ignore need export from superset-ui `ItemWithValue`\n  return (_getChartMetadataRegi = getChartMetadataRegistry().items[vizType]) == null ? void 0 : (_getChartMetadataRegi2 = _getChartMetadataRegi.value.behaviors) == null ? void 0 : _includesInstanceProperty(_getChartMetadataRegi2).call(_getChartMetadataRegi2, Behavior.CROSS_FILTER);\n}\nexport function getExtraFormData(dataMask, charts, filterIdsAppliedOnChart) {\n  let extraFormData = {};\n  _forEachInstanceProperty(filterIdsAppliedOnChart).call(filterIdsAppliedOnChart, key => {var _ref, _dataMask$nativeFilte;\n    const singleDataMask = (_ref = (_dataMask$nativeFilte = dataMask.nativeFilters[key]) != null ? _dataMask$nativeFilte : dataMask.crossFilters[key]) != null ? _ref : {};\n    const { extraFormData: newExtra = {} } = singleDataMask;\n    extraFormData = mergeExtraFormData(extraFormData, newExtra);\n  });\n  return extraFormData;\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(getFormData, \"getFormData\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/utils.ts\");reactHotLoader.register(mergeExtraFormData, \"mergeExtraFormData\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/utils.ts\");reactHotLoader.register(isCrossFilter, \"isCrossFilter\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/utils.ts\");reactHotLoader.register(getExtraFormData, \"getExtraFormData\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/utils.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/components/nativeFilters/utils.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ExtraFormData,\n  QueryFormData,\n  getChartMetadataRegistry,\n  QueryObject,\n  Behavior,\n} from '@superset-ui/core';\nimport { Charts } from 'src/dashboard/types';\nimport { RefObject } from 'react';\nimport { DataMaskStateWithId } from 'src/dataMask/types';\nimport { Filter } from './types';\n\nexport const getFormData = ({\n  datasetId,\n  cascadingFilters = {},\n  groupby,\n  currentValue,\n  inputRef,\n  defaultValue,\n  controlValues,\n  filterType,\n}: Partial<Filter> & {\n  datasetId?: number;\n  inputRef?: RefObject<HTMLInputElement>;\n  cascadingFilters?: object;\n  groupby?: string;\n}): Partial<QueryFormData> => {\n  const otherProps: { datasource?: string; groupby?: string[] } = {};\n  if (datasetId) {\n    otherProps.datasource = `${datasetId}__table`;\n  }\n  if (groupby) {\n    otherProps.groupby = [groupby];\n  }\n  return {\n    ...controlValues,\n    ...otherProps,\n    adhoc_filters: [],\n    extra_filters: [],\n    extra_form_data: cascadingFilters,\n    granularity_sqla: 'ds',\n    metrics: ['count'],\n    row_limit: 10000,\n    showSearch: true,\n    currentValue,\n    defaultValue,\n    time_range: 'No filter',\n    time_range_endpoints: ['inclusive', 'exclusive'],\n    url_params: {},\n    viz_type: filterType,\n    inputRef,\n  };\n};\n\nexport function mergeExtraFormData(\n  originalExtra: ExtraFormData = {},\n  newExtra: ExtraFormData,\n): ExtraFormData {\n  const {\n    override_form_data: originalOverride = {},\n    append_form_data: originalAppend = {},\n  } = originalExtra;\n  const {\n    override_form_data: newOverride = {},\n    append_form_data: newAppend = {},\n    custom_form_data: newCustom = {},\n  } = newExtra;\n\n  const appendKeys = new Set([\n    ...Object.keys(originalAppend),\n    ...Object.keys(newAppend),\n  ]);\n  const appendFormData: Partial<QueryObject> = {};\n  appendKeys.forEach(key => {\n    appendFormData[key] = [\n      // @ts-ignore\n      ...(originalAppend?.[key] || []),\n      // @ts-ignore\n      ...(newAppend?.[key] || []),\n    ];\n  });\n\n  return {\n    custom_form_data: newCustom,\n    override_form_data: {\n      ...originalOverride,\n      ...newOverride,\n    },\n    append_form_data: appendFormData,\n  };\n}\n\nexport function isCrossFilter(vizType: string) {\n  // @ts-ignore need export from superset-ui `ItemWithValue`\n  return getChartMetadataRegistry().items[vizType]?.value.behaviors?.includes(\n    Behavior.CROSS_FILTER,\n  );\n}\n\nexport function getExtraFormData(\n  dataMask: DataMaskStateWithId,\n  charts: Charts,\n  filterIdsAppliedOnChart: string[],\n): ExtraFormData {\n  let extraFormData: ExtraFormData = {};\n  filterIdsAppliedOnChart.forEach(key => {\n    const singleDataMask =\n      dataMask.nativeFilters[key] ?? dataMask.crossFilters[key] ?? {};\n    const { extraFormData: newExtra = {} } = singleDataMask;\n    extraFormData = mergeExtraFormData(extraFormData, newExtra);\n  });\n  return extraFormData;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}