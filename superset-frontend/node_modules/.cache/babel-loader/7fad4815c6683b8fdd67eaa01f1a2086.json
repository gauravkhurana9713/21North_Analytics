{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _findIndexInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find-index\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _Object$is from \"@babel/runtime-corejs3/core-js-stable/object/is\";import _Array$isArray from \"@babel/runtime-corejs3/core-js-stable/array/is-array\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { Select, CreatableSelect, OnPasteSelect } from 'src/components/Select';\nimport ControlHeader from 'src/explore/components/ControlHeader';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  autoFocus: PropTypes.bool,\n  choices: PropTypes.array,\n  clearable: PropTypes.bool,\n  description: PropTypes.string,\n  disabled: PropTypes.bool,\n  freeForm: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  label: PropTypes.string,\n  multi: PropTypes.bool,\n  isMulti: PropTypes.bool,\n  allowAll: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  onFocus: PropTypes.func,\n  value: PropTypes.oneOfType([\n  PropTypes.string,\n  PropTypes.number,\n  PropTypes.array]),\n\n  showHeader: PropTypes.bool,\n  optionRenderer: PropTypes.func,\n  valueRenderer: PropTypes.func,\n  valueKey: PropTypes.string,\n  options: PropTypes.array,\n  placeholder: PropTypes.string,\n  noResultsText: PropTypes.string,\n  selectRef: PropTypes.func,\n  filterOption: PropTypes.func,\n  promptTextCreator: PropTypes.func,\n  commaChoosesOption: PropTypes.bool,\n  menuPortalTarget: PropTypes.element,\n  menuPosition: PropTypes.string,\n  menuPlacement: PropTypes.string,\n  forceOverflow: PropTypes.bool };\n\n\nconst defaultProps = {\n  autoFocus: false,\n  choices: [],\n  clearable: true,\n  description: null,\n  disabled: false,\n  freeForm: false,\n  isLoading: false,\n  label: null,\n  multi: false,\n  onChange: () => {},\n  onFocus: () => {},\n  showHeader: true,\n  valueKey: 'value',\n  noResultsText: t('No results found'),\n  promptTextCreator: label => `Create Option ${label}`,\n  commaChoosesOption: true,\n  allowAll: false };\n\n\nexport default class SelectControl extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    this.state = {\n      options: this.getOptions(props),\n      value: this.props.value };\n\n    this.onChange = _bindInstanceProperty(_context = this.onChange).call(_context, this);\n    this.createMetaSelectAllOption = _bindInstanceProperty(_context2 = this.createMetaSelectAllOption).call(_context2, this);\n    this.select = null; // pointer to the react-select instance\n    this.getSelectRef = _bindInstanceProperty(_context3 = this.getSelectRef).call(_context3, this);\n    this.handleKeyDownForCreate = _bindInstanceProperty(_context4 = this.handleKeyDownForCreate).call(_context4, this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n    nextProps.choices !== this.props.choices ||\n    nextProps.options !== this.props.options)\n    {\n      const options = this.getOptions(nextProps);\n      this.setState({ options });\n    }\n  }\n\n  // Beware: This is acting like an on-click instead of an on-change\n  // (firing every time user chooses vs firing only if a new option is chosen).\n  onChange(opt) {\n    let optionValue = this.props.multi ? [] : null;\n    if (opt) {\n      if (this.props.multi) {\n        _forEachInstanceProperty(opt).call(opt, o => {\n          // select all options\n          if (o.meta === true) {var _context5, _context6;\n            optionValue = _mapInstanceProperty(_context5 = _filterInstanceProperty(_context6 = this.getOptions(this.props)).call(_context6,\n            x => !x.meta)).call(_context5,\n            x => x[this.props.valueKey]);\n            return;\n          }\n          optionValue.push(o[this.props.valueKey] || o);\n        });\n      } else if (opt.meta === true) {\n        return;\n      } else {\n        optionValue = opt[this.props.valueKey];\n      }\n    }\n    // will eventually call `exploreReducer`: SET_FIELD_VALUE\n    this.props.onChange(optionValue);\n  }\n\n  getSelectRef(instance) {\n    this.select = instance;\n    if (this.props.selectRef) {\n      this.props.selectRef(instance);\n    }\n  }\n\n  getOptions(props) {\n    let options = [];\n    if (props.options) {var _context7;\n      options = _mapInstanceProperty(_context7 = props.options).call(_context7, x => x);\n    } else if (props.choices) {var _context8;\n      // Accepts different formats of input\n      options = _mapInstanceProperty(_context8 = props.choices).call(_context8, c => {\n        if (_Array$isArray(c)) {\n          const [value, label] = c.length > 1 ? c : [c[0], c[0]];\n          return { label, [props.valueKey]: value };\n        }\n        if (_Object$is(c)) {\n          return c;\n        }\n        return { label: c, [props.valueKey]: c };\n      });\n    }\n    // For FreeFormSelect, insert newly created values into options\n    if (props.freeForm && props.value) {\n      const existingOptionValues = new _Set(_mapInstanceProperty(options).call(options, c => c[props.valueKey]));\n      const selectedValues = _Array$isArray(props.value) ?\n      props.value :\n      [props.value];\n      _forEachInstanceProperty(selectedValues).call(selectedValues, v => {\n        if (!existingOptionValues.has(v)) {\n          // place the newly created options at the top\n          options.unshift({ label: v, [props.valueKey]: v });\n        }\n      });\n    }\n    if (props.allowAll === true && props.multi === true) {\n      if (!this.optionsIncludesSelectAll(options)) {\n        options.unshift(this.createMetaSelectAllOption());\n      }\n    } else {\n      options = _filterInstanceProperty(options).call(options, o => !this.isMetaSelectAllOption(o));\n    }\n    return options;\n  }\n\n  handleKeyDownForCreate(event) {\n    const { key } = event;\n    if (key === 'Tab' || this.props.commaChoosesOption && key === ',') {\n      // simulate an Enter event\n      if (this.select) {\n        this.select.onKeyDown({ ...event, key: 'Enter' });\n      }\n    }\n  }\n\n  isMetaSelectAllOption(o) {\n    return o.meta && o.meta === true && o.label === 'Select all';\n  }\n\n  optionsIncludesSelectAll(o) {\n    return _findIndexInstanceProperty(o).call(o, o => this.isMetaSelectAllOption(o)) >= 0;\n  }\n\n  optionsRemaining() {\n    const { options } = this.state;\n    const { value } = this.props;\n    // if select is multi/value is array, we show the options not selected\n    let remainingOptions = _Array$isArray(value) ?\n    options.length - value.length :\n    options.length;\n    if (this.optionsIncludesSelectAll(options)) {\n      remainingOptions -= 1;\n    }\n    return remainingOptions < 0 ? 0 : remainingOptions;\n  }\n\n  createMetaSelectAllOption() {\n    const option = { label: 'Select all', meta: true };\n    option[this.props.valueKey] = 'Select all';\n    return option;\n  }\n\n  render() {\n    //  Tab, comma or Enter will trigger a new option created for FreeFormSelect\n    const {\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      isLoading,\n      menuPlacement,\n      name,\n      noResultsText,\n      onFocus,\n      optionRenderer,\n      promptTextCreator,\n      value,\n      valueKey,\n      valueRenderer,\n      forceOverflow,\n      menuPortalTarget,\n      menuPosition } =\n    this.props;\n\n    const optionsRemaining = this.optionsRemaining();\n    const optionRemaingText = optionsRemaining ?\n    t('%s option(s)', optionsRemaining) :\n    '';\n    const placeholder = this.props.placeholder || optionRemaingText;\n    const isMulti = this.props.isMulti || this.props.multi;\n\n    let assistiveText;\n    if (\n    isMulti &&\n    optionsRemaining &&\n    _Array$isArray(this.state.value) &&\n    _Array$isArray(value) &&\n    !!value.length)\n    {\n      assistiveText = optionRemaingText;\n    }\n\n    const selectProps = {\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      ignoreAccents: false,\n      isLoading,\n      isMulti,\n      labelKey: 'label',\n      menuPlacement,\n      forceOverflow,\n      menuPortalTarget,\n      menuPosition,\n      name: `select-${name}`,\n      noResultsText,\n      onChange: this.onChange,\n      onFocus,\n      optionRenderer,\n      value,\n      options: this.state.options,\n      placeholder,\n      assistiveText,\n      promptTextCreator,\n      selectRef: this.getSelectRef,\n      valueKey,\n      valueRenderer };\n\n\n    let SelectComponent;\n    if (this.props.freeForm) {\n      SelectComponent = CreatableSelect;\n      // Don't create functions in `render` because React relies on shallow\n      // compare to decide weathere to rerender child components.\n      selectProps.onKeyDown = this.handleKeyDownForCreate;\n    } else {\n      SelectComponent = Select;\n    }\n\n    return (\n      ___EmotionJSX(\"div\", null,\n      this.props.showHeader && ___EmotionJSX(ControlHeader, this.props),\n      isMulti ?\n      ___EmotionJSX(OnPasteSelect, _extends({}, selectProps, { selectWrap: SelectComponent })) :\n\n      ___EmotionJSX(SelectComponent, selectProps)));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nSelectControl.propTypes = propTypes;\nSelectControl.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/SelectControl.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/explore/components/controls/SelectControl.jsx\");reactHotLoader.register(SelectControl, \"SelectControl\", \"/app/superset-frontend/src/explore/components/controls/SelectControl.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/SelectControl.jsx"],"names":["React","PropTypes","t","Select","CreatableSelect","OnPasteSelect","ControlHeader","propTypes","autoFocus","bool","choices","array","clearable","description","string","disabled","freeForm","isLoading","label","multi","isMulti","allowAll","name","isRequired","onChange","func","onFocus","value","oneOfType","number","showHeader","optionRenderer","valueRenderer","valueKey","options","placeholder","noResultsText","selectRef","filterOption","promptTextCreator","commaChoosesOption","menuPortalTarget","element","menuPosition","menuPlacement","forceOverflow","defaultProps","SelectControl","PureComponent","constructor","props","state","getOptions","createMetaSelectAllOption","select","getSelectRef","handleKeyDownForCreate","UNSAFE_componentWillReceiveProps","nextProps","setState","opt","optionValue","o","meta","x","push","instance","c","length","existingOptionValues","selectedValues","v","has","unshift","optionsIncludesSelectAll","isMetaSelectAllOption","event","key","onKeyDown","optionsRemaining","remainingOptions","option","render","optionRemaingText","assistiveText","selectProps","ignoreAccents","labelKey","SelectComponent"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { Select, CreatableSelect, OnPasteSelect } from 'src/components/Select';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  autoFocus: PropTypes.bool,\n  choices: PropTypes.array,\n  clearable: PropTypes.bool,\n  description: PropTypes.string,\n  disabled: PropTypes.bool,\n  freeForm: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  label: PropTypes.string,\n  multi: PropTypes.bool,\n  isMulti: PropTypes.bool,\n  allowAll: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  onFocus: PropTypes.func,\n  value: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  showHeader: PropTypes.bool,\n  optionRenderer: PropTypes.func,\n  valueRenderer: PropTypes.func,\n  valueKey: PropTypes.string,\n  options: PropTypes.array,\n  placeholder: PropTypes.string,\n  noResultsText: PropTypes.string,\n  selectRef: PropTypes.func,\n  filterOption: PropTypes.func,\n  promptTextCreator: PropTypes.func,\n  commaChoosesOption: PropTypes.bool,\n  menuPortalTarget: PropTypes.element,\n  menuPosition: PropTypes.string,\n  menuPlacement: PropTypes.string,\n  forceOverflow: PropTypes.bool,\n};\n\nconst defaultProps = {\n  autoFocus: false,\n  choices: [],\n  clearable: true,\n  description: null,\n  disabled: false,\n  freeForm: false,\n  isLoading: false,\n  label: null,\n  multi: false,\n  onChange: () => {},\n  onFocus: () => {},\n  showHeader: true,\n  valueKey: 'value',\n  noResultsText: t('No results found'),\n  promptTextCreator: label => `Create Option ${label}`,\n  commaChoosesOption: true,\n  allowAll: false,\n};\n\nexport default class SelectControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      options: this.getOptions(props),\n      value: this.props.value,\n    };\n    this.onChange = this.onChange.bind(this);\n    this.createMetaSelectAllOption = this.createMetaSelectAllOption.bind(this);\n    this.select = null; // pointer to the react-select instance\n    this.getSelectRef = this.getSelectRef.bind(this);\n    this.handleKeyDownForCreate = this.handleKeyDownForCreate.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n      nextProps.choices !== this.props.choices ||\n      nextProps.options !== this.props.options\n    ) {\n      const options = this.getOptions(nextProps);\n      this.setState({ options });\n    }\n  }\n\n  // Beware: This is acting like an on-click instead of an on-change\n  // (firing every time user chooses vs firing only if a new option is chosen).\n  onChange(opt) {\n    let optionValue = this.props.multi ? [] : null;\n    if (opt) {\n      if (this.props.multi) {\n        opt.forEach(o => {\n          // select all options\n          if (o.meta === true) {\n            optionValue = this.getOptions(this.props)\n              .filter(x => !x.meta)\n              .map(x => x[this.props.valueKey]);\n            return;\n          }\n          optionValue.push(o[this.props.valueKey] || o);\n        });\n      } else if (opt.meta === true) {\n        return;\n      } else {\n        optionValue = opt[this.props.valueKey];\n      }\n    }\n    // will eventually call `exploreReducer`: SET_FIELD_VALUE\n    this.props.onChange(optionValue);\n  }\n\n  getSelectRef(instance) {\n    this.select = instance;\n    if (this.props.selectRef) {\n      this.props.selectRef(instance);\n    }\n  }\n\n  getOptions(props) {\n    let options = [];\n    if (props.options) {\n      options = props.options.map(x => x);\n    } else if (props.choices) {\n      // Accepts different formats of input\n      options = props.choices.map(c => {\n        if (Array.isArray(c)) {\n          const [value, label] = c.length > 1 ? c : [c[0], c[0]];\n          return { label, [props.valueKey]: value };\n        }\n        if (Object.is(c)) {\n          return c;\n        }\n        return { label: c, [props.valueKey]: c };\n      });\n    }\n    // For FreeFormSelect, insert newly created values into options\n    if (props.freeForm && props.value) {\n      const existingOptionValues = new Set(options.map(c => c[props.valueKey]));\n      const selectedValues = Array.isArray(props.value)\n        ? props.value\n        : [props.value];\n      selectedValues.forEach(v => {\n        if (!existingOptionValues.has(v)) {\n          // place the newly created options at the top\n          options.unshift({ label: v, [props.valueKey]: v });\n        }\n      });\n    }\n    if (props.allowAll === true && props.multi === true) {\n      if (!this.optionsIncludesSelectAll(options)) {\n        options.unshift(this.createMetaSelectAllOption());\n      }\n    } else {\n      options = options.filter(o => !this.isMetaSelectAllOption(o));\n    }\n    return options;\n  }\n\n  handleKeyDownForCreate(event) {\n    const { key } = event;\n    if (key === 'Tab' || (this.props.commaChoosesOption && key === ',')) {\n      // simulate an Enter event\n      if (this.select) {\n        this.select.onKeyDown({ ...event, key: 'Enter' });\n      }\n    }\n  }\n\n  isMetaSelectAllOption(o) {\n    return o.meta && o.meta === true && o.label === 'Select all';\n  }\n\n  optionsIncludesSelectAll(o) {\n    return o.findIndex(o => this.isMetaSelectAllOption(o)) >= 0;\n  }\n\n  optionsRemaining() {\n    const { options } = this.state;\n    const { value } = this.props;\n    // if select is multi/value is array, we show the options not selected\n    let remainingOptions = Array.isArray(value)\n      ? options.length - value.length\n      : options.length;\n    if (this.optionsIncludesSelectAll(options)) {\n      remainingOptions -= 1;\n    }\n    return remainingOptions < 0 ? 0 : remainingOptions;\n  }\n\n  createMetaSelectAllOption() {\n    const option = { label: 'Select all', meta: true };\n    option[this.props.valueKey] = 'Select all';\n    return option;\n  }\n\n  render() {\n    //  Tab, comma or Enter will trigger a new option created for FreeFormSelect\n    const {\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      isLoading,\n      menuPlacement,\n      name,\n      noResultsText,\n      onFocus,\n      optionRenderer,\n      promptTextCreator,\n      value,\n      valueKey,\n      valueRenderer,\n      forceOverflow,\n      menuPortalTarget,\n      menuPosition,\n    } = this.props;\n\n    const optionsRemaining = this.optionsRemaining();\n    const optionRemaingText = optionsRemaining\n      ? t('%s option(s)', optionsRemaining)\n      : '';\n    const placeholder = this.props.placeholder || optionRemaingText;\n    const isMulti = this.props.isMulti || this.props.multi;\n\n    let assistiveText;\n    if (\n      isMulti &&\n      optionsRemaining &&\n      Array.isArray(this.state.value) &&\n      Array.isArray(value) &&\n      !!value.length\n    ) {\n      assistiveText = optionRemaingText;\n    }\n\n    const selectProps = {\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      ignoreAccents: false,\n      isLoading,\n      isMulti,\n      labelKey: 'label',\n      menuPlacement,\n      forceOverflow,\n      menuPortalTarget,\n      menuPosition,\n      name: `select-${name}`,\n      noResultsText,\n      onChange: this.onChange,\n      onFocus,\n      optionRenderer,\n      value,\n      options: this.state.options,\n      placeholder,\n      assistiveText,\n      promptTextCreator,\n      selectRef: this.getSelectRef,\n      valueKey,\n      valueRenderer,\n    };\n\n    let SelectComponent;\n    if (this.props.freeForm) {\n      SelectComponent = CreatableSelect;\n      // Don't create functions in `render` because React relies on shallow\n      // compare to decide weathere to rerender child components.\n      selectProps.onKeyDown = this.handleKeyDownForCreate;\n    } else {\n      SelectComponent = Select;\n    }\n\n    return (\n      <div>\n        {this.props.showHeader && <ControlHeader {...this.props} />}\n        {isMulti ? (\n          <OnPasteSelect {...selectProps} selectWrap={SelectComponent} />\n        ) : (\n          <SelectComponent {...selectProps} />\n        )}\n      </div>\n    );\n  }\n}\n\nSelectControl.propTypes = propTypes;\nSelectControl.defaultProps = defaultProps;\n"]},"metadata":{},"sourceType":"module"}