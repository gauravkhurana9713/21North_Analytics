{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _startsWithInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/starts-with\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport shortid from 'shortid';\nimport { t, styled } from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport Icons from 'src/components/Icons';\nimport Fieldset from './Fieldset';\nimport { recurseReactClone } from './utils';\nimport './crud.less';import { jsx as ___EmotionJSX } from \"@emotion/core\";\nfunction createKeyedCollection(arr) {\n  const newArr = _mapInstanceProperty(arr).call(arr, o => ({\n    ...o,\n    id: o.id || shortid.generate() }));\n\n  const map = {};\n  _forEachInstanceProperty(newArr).call(newArr, o => {\n    map[o.id] = o;\n  });\n  return map;\n}\nconst CrudTableWrapper = styled.div`\n  ${({ stickyHeader }) => stickyHeader &&\n`\n      height: 350px;\n      overflow: auto;\n\n      thead th {\n        background: #fff;\n        position: sticky;\n        top: 0;\n        z-index: 9;\n      }\n    `}\n`;\nconst CrudButtonWrapper = styled.div`\n  text-align: right;\n  ${({ theme }) => `margin-bottom: ${theme.gridUnit * 2}px`}\n`;\nexport default class CRUDCollection extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6, _context7;\n    super(props);\n    this.state = {\n      expandedColumns: {},\n      collection: createKeyedCollection(props.collection) };\n\n    this.renderItem = _bindInstanceProperty(_context = this.renderItem).call(_context, this);\n    this.onAddItem = _bindInstanceProperty(_context2 = this.onAddItem).call(_context2, this);\n    this.renderExpandableSection = _bindInstanceProperty(_context3 = this.renderExpandableSection).call(_context3, this);\n    this.getLabel = _bindInstanceProperty(_context4 = this.getLabel).call(_context4, this);\n    this.onFieldsetChange = _bindInstanceProperty(_context5 = this.onFieldsetChange).call(_context5, this);\n    this.renderTableBody = _bindInstanceProperty(_context6 = this.renderTableBody).call(_context6, this);\n    this.changeCollection = _bindInstanceProperty(_context7 = this.changeCollection).call(_context7, this);\n  }\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (nextProps.collection !== this.props.collection) {\n      this.setState({\n        collection: createKeyedCollection(nextProps.collection) });\n\n    }\n  }\n  onCellChange(id, col, val) {\n    this.changeCollection({\n      ...this.state.collection,\n      [id]: {\n        ...this.state.collection[id],\n        [col]: val } });\n\n\n  }\n  onAddItem() {\n    if (this.props.itemGenerator) {\n      let newItem = this.props.itemGenerator();\n      if (!newItem.id) {\n        newItem = { ...newItem, id: shortid.generate() };\n      }\n      this.changeCollection({\n        ...this.state.collection,\n        [newItem.id]: newItem });\n\n    }\n  }\n  onFieldsetChange(item) {\n    this.changeCollection({\n      ...this.state.collection,\n      [item.id]: item });\n\n  }\n  getLabel(col) {\n    const { columnLabels } = this.props;\n    let label = columnLabels && columnLabels[col] ? columnLabels[col] : col;\n    if (_startsWithInstanceProperty(label).call(label, '__')) {\n      // special label-free columns (ie: caret for expand, delete cross)\n      label = '';\n    }\n    return label;\n  }\n  changeCollection(collection) {\n    this.setState({ collection });\n    if (this.props.onChange) {var _context8;\n      this.props.onChange(_mapInstanceProperty(_context8 = _Object$keys(collection)).call(_context8, k => collection[k]));\n    }\n  }\n  deleteItem(id) {\n    const newColl = { ...this.state.collection };\n    delete newColl[id];\n    this.changeCollection(newColl);\n  }\n  effectiveTableColumns() {var _context9;\n    const { tableColumns, allowDeletes, expandFieldset } = this.props;\n    const cols = allowDeletes ?\n    _concatInstanceProperty(tableColumns).call(tableColumns, ['__actions']) :\n    tableColumns;\n    return expandFieldset ? _concatInstanceProperty(_context9 = ['__expand']).call(_context9, cols) : cols;\n  }\n  toggleExpand(id) {\n    this.onCellChange(id, '__expanded', false);\n    this.setState(prevState => ({\n      expandedColumns: {\n        ...prevState.expandedColumns,\n        [id]: !prevState.expandedColumns[id] } }));\n\n\n  }\n  renderHeaderRow() {\n    const cols = this.effectiveTableColumns();\n    const { allowDeletes, expandFieldset, extraButtons } = this.props;\n    return ___EmotionJSX(\"thead\", null,\n    ___EmotionJSX(\"tr\", null,\n    expandFieldset && ___EmotionJSX(\"th\", { \"aria-label\": \"Expand\", className: \"tiny-cell\" }),\n    _mapInstanceProperty(cols).call(cols, col => ___EmotionJSX(\"th\", { key: col }, this.getLabel(col))),\n    extraButtons,\n    allowDeletes && ___EmotionJSX(\"th\", { key: \"delete-item\", \"aria-label\": \"Delete\", className: \"tiny-cell\" })));\n\n\n  }\n  renderExpandableSection(item) {\n    const propsGenerator = () => ({ item, onChange: this.onFieldsetChange });\n    return recurseReactClone(this.props.expandFieldset, Fieldset, propsGenerator);\n  }\n  renderCell(record, col) {var _context10;\n    const renderer = this.props.itemRenderers && this.props.itemRenderers[col];\n    const val = record[col];\n    const onChange = _bindInstanceProperty(_context10 = this.onCellChange).call(_context10, this, record.id, col);\n    return renderer ? renderer(val, onChange, this.getLabel(col), record) : val;\n  }\n  renderItem(record) {\n    const { allowAddItem, allowDeletes, expandFieldset, tableColumns } = this.props;\n    /* eslint-disable no-underscore-dangle */\n    const isExpanded = !!this.state.expandedColumns[record.id] || record.__expanded;\n    let tds = [];\n    if (expandFieldset) {var _context11;\n      tds.push(___EmotionJSX(\"td\", { key: \"__expand\", className: \"expand\" },\n      ___EmotionJSX(\"i\", { role: \"button\", \"aria-label\": \"Toggle expand\", tabIndex: 0, className: `fa fa-caret-${isExpanded ? 'down' : 'right'} text-primary pointer`, onClick: _bindInstanceProperty(_context11 = this.toggleExpand).call(_context11, this, record.id) })));\n\n    }\n    tds = _concatInstanceProperty(tds).call(tds, _mapInstanceProperty(tableColumns).call(tableColumns, col => ___EmotionJSX(\"td\", { key: col }, this.renderCell(record, col))));\n    if (allowAddItem) {\n      tds.push(___EmotionJSX(\"td\", { key: \"add\" }));\n    }\n    if (allowDeletes) {var _context12;\n      tds.push(___EmotionJSX(\"td\", { key: \"__actions\", \"data-test\": \"crud-delete-option\", className: \"text-primary\" },\n      ___EmotionJSX(Icons.Trash, { \"aria-label\": \"Delete item\", className: \"pointer\", \"data-test\": \"crud-delete-icon\", iconSize: \"m\", role: \"button\", tabIndex: 0, onClick: _bindInstanceProperty(_context12 = this.deleteItem).call(_context12, this, record.id) })));\n\n    }\n    const trs = [\n    ___EmotionJSX(\"tr\", _extends({ 'data-test': 'table-row' }, { className: \"row\", key: record.id }),\n    tds)];\n\n\n    if (isExpanded) {\n      trs.push(___EmotionJSX(\"tr\", { className: \"exp\", key: `exp__${record.id}` },\n      ___EmotionJSX(\"td\", { colSpan: this.effectiveTableColumns().length, className: \"expanded\" },\n      ___EmotionJSX(\"div\", null, this.renderExpandableSection(record)))));\n\n\n    }\n    return trs;\n  }\n  renderEmptyCell() {\n    return ___EmotionJSX(\"tr\", null,\n    ___EmotionJSX(\"td\", { className: \"empty-collection\" }, this.props.emptyMessage));\n\n  }\n  renderTableBody() {var _context13;\n    const data = _mapInstanceProperty(_context13 = _Object$keys(this.state.collection)).call(_context13, k => this.state.collection[k]);\n    const content = data.length ?\n    _mapInstanceProperty(data).call(data, d => this.renderItem(d)) :\n    this.renderEmptyCell();\n    return ___EmotionJSX(\"tbody\", { \"data-test\": \"table-content-rows\" }, content);\n  }\n  render() {\n    return ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(CrudButtonWrapper, null,\n    this.props.allowAddItem && ___EmotionJSX(\"span\", { className: \"m-t-10 m-r-10\" },\n    ___EmotionJSX(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: this.onAddItem, \"data-test\": \"add-item-button\" },\n    ___EmotionJSX(\"i\", { \"data-test\": \"crud-add-table-item\", className: \"fa fa-plus\" }), ' ',\n    t('Add item')))),\n\n\n\n    ___EmotionJSX(CrudTableWrapper, { className: \"CRUD\", stickyHeader: this.props.stickyHeader },\n    ___EmotionJSX(\"table\", { \"data-test\": \"crud-table\", className: \"table\" },\n    this.renderHeaderRow(),\n    this.renderTableBody())));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(createKeyedCollection, \"createKeyedCollection\", \"/app/superset-frontend/src/CRUD/CollectionTable.tsx\");reactHotLoader.register(CrudTableWrapper, \"CrudTableWrapper\", \"/app/superset-frontend/src/CRUD/CollectionTable.tsx\");reactHotLoader.register(CrudButtonWrapper, \"CrudButtonWrapper\", \"/app/superset-frontend/src/CRUD/CollectionTable.tsx\");reactHotLoader.register(CRUDCollection, \"CRUDCollection\", \"/app/superset-frontend/src/CRUD/CollectionTable.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/CRUD/CollectionTable.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport shortid from 'shortid';\nimport { t, styled } from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport Icons from 'src/components/Icons';\nimport Fieldset from './Fieldset';\nimport { recurseReactClone } from './utils';\nimport './crud.less';\n\ninterface CRUDCollectionProps {\n  allowAddItem?: boolean;\n  allowDeletes?: boolean;\n  collection: Array<object>;\n  columnLabels?: object;\n  emptyMessage?: ReactNode;\n  expandFieldset?: ReactNode;\n  extraButtons?: ReactNode;\n  itemGenerator?: () => any;\n  itemRenderers?: ((\n    val: unknown,\n    onChange: () => void,\n    label: string,\n    record: any,\n  ) => ReactNode)[];\n  onChange?: (arg0: any) => void;\n  tableColumns: Array<any>;\n  stickyHeader?: boolean;\n}\n\ninterface CRUDCollectionState {\n  collection: object;\n  expandedColumns: object;\n}\n\nfunction createKeyedCollection(arr: Array<object>) {\n  const newArr = arr.map((o: any) => ({\n    ...o,\n    id: o.id || shortid.generate(),\n  }));\n  const map = {};\n  newArr.forEach((o: any) => {\n    map[o.id] = o;\n  });\n  return map;\n}\n\nconst CrudTableWrapper = styled.div<{ stickyHeader?: boolean }>`\n  ${({ stickyHeader }) =>\n    stickyHeader &&\n    `\n      height: 350px;\n      overflow: auto;\n\n      thead th {\n        background: #fff;\n        position: sticky;\n        top: 0;\n        z-index: 9;\n      }\n    `}\n`;\n\nconst CrudButtonWrapper = styled.div`\n  text-align: right;\n  ${({ theme }) => `margin-bottom: ${theme.gridUnit * 2}px`}\n`;\n\nexport default class CRUDCollection extends React.PureComponent<\n  CRUDCollectionProps,\n  CRUDCollectionState\n> {\n  constructor(props: CRUDCollectionProps) {\n    super(props);\n    this.state = {\n      expandedColumns: {},\n      collection: createKeyedCollection(props.collection),\n    };\n    this.renderItem = this.renderItem.bind(this);\n    this.onAddItem = this.onAddItem.bind(this);\n    this.renderExpandableSection = this.renderExpandableSection.bind(this);\n    this.getLabel = this.getLabel.bind(this);\n    this.onFieldsetChange = this.onFieldsetChange.bind(this);\n    this.renderTableBody = this.renderTableBody.bind(this);\n    this.changeCollection = this.changeCollection.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: CRUDCollectionProps) {\n    if (nextProps.collection !== this.props.collection) {\n      this.setState({\n        collection: createKeyedCollection(nextProps.collection),\n      });\n    }\n  }\n\n  onCellChange(id: number, col: string, val: boolean) {\n    this.changeCollection({\n      ...this.state.collection,\n      [id]: {\n        ...this.state.collection[id],\n        [col]: val,\n      },\n    });\n  }\n\n  onAddItem() {\n    if (this.props.itemGenerator) {\n      let newItem = this.props.itemGenerator();\n      if (!newItem.id) {\n        newItem = { ...newItem, id: shortid.generate() };\n      }\n      this.changeCollection({\n        ...this.state.collection,\n        [newItem.id]: newItem,\n      });\n    }\n  }\n\n  onFieldsetChange(item: any) {\n    this.changeCollection({\n      ...this.state.collection,\n      [item.id]: item,\n    });\n  }\n\n  getLabel(col: any) {\n    const { columnLabels } = this.props;\n    let label = columnLabels && columnLabels[col] ? columnLabels[col] : col;\n    if (label.startsWith('__')) {\n      // special label-free columns (ie: caret for expand, delete cross)\n      label = '';\n    }\n    return label;\n  }\n\n  changeCollection(collection: any) {\n    this.setState({ collection });\n    if (this.props.onChange) {\n      this.props.onChange(Object.keys(collection).map(k => collection[k]));\n    }\n  }\n\n  deleteItem(id: number) {\n    const newColl = { ...this.state.collection };\n    delete newColl[id];\n    this.changeCollection(newColl);\n  }\n\n  effectiveTableColumns() {\n    const { tableColumns, allowDeletes, expandFieldset } = this.props;\n    const cols = allowDeletes\n      ? tableColumns.concat(['__actions'])\n      : tableColumns;\n    return expandFieldset ? ['__expand'].concat(cols) : cols;\n  }\n\n  toggleExpand(id: any) {\n    this.onCellChange(id, '__expanded', false);\n    this.setState(prevState => ({\n      expandedColumns: {\n        ...prevState.expandedColumns,\n        [id]: !prevState.expandedColumns[id],\n      },\n    }));\n  }\n\n  renderHeaderRow() {\n    const cols = this.effectiveTableColumns();\n    const { allowDeletes, expandFieldset, extraButtons } = this.props;\n    return (\n      <thead>\n        <tr>\n          {expandFieldset && <th aria-label=\"Expand\" className=\"tiny-cell\" />}\n          {cols.map(col => (\n            <th key={col}>{this.getLabel(col)}</th>\n          ))}\n          {extraButtons}\n          {allowDeletes && (\n            <th key=\"delete-item\" aria-label=\"Delete\" className=\"tiny-cell\" />\n          )}\n        </tr>\n      </thead>\n    );\n  }\n\n  renderExpandableSection(item: any) {\n    const propsGenerator = () => ({ item, onChange: this.onFieldsetChange });\n    return recurseReactClone(\n      this.props.expandFieldset,\n      Fieldset,\n      propsGenerator,\n    );\n  }\n\n  renderCell(record: any, col: any) {\n    const renderer = this.props.itemRenderers && this.props.itemRenderers[col];\n    const val = record[col];\n    const onChange = this.onCellChange.bind(this, record.id, col);\n    return renderer ? renderer(val, onChange, this.getLabel(col), record) : val;\n  }\n\n  renderItem(record: any) {\n    const {\n      allowAddItem,\n      allowDeletes,\n      expandFieldset,\n      tableColumns,\n    } = this.props;\n    /* eslint-disable no-underscore-dangle */\n    const isExpanded =\n      !!this.state.expandedColumns[record.id] || record.__expanded;\n    let tds = [];\n    if (expandFieldset) {\n      tds.push(\n        <td key=\"__expand\" className=\"expand\">\n          <i\n            role=\"button\"\n            aria-label=\"Toggle expand\"\n            tabIndex={0}\n            className={`fa fa-caret-${\n              isExpanded ? 'down' : 'right'\n            } text-primary pointer`}\n            onClick={this.toggleExpand.bind(this, record.id)}\n          />\n        </td>,\n      );\n    }\n    tds = tds.concat(\n      tableColumns.map(col => (\n        <td key={col}>{this.renderCell(record, col)}</td>\n      )),\n    );\n    if (allowAddItem) {\n      tds.push(<td key=\"add\" />);\n    }\n    if (allowDeletes) {\n      tds.push(\n        <td\n          key=\"__actions\"\n          data-test=\"crud-delete-option\"\n          className=\"text-primary\"\n        >\n          <Icons.Trash\n            aria-label=\"Delete item\"\n            className=\"pointer\"\n            data-test=\"crud-delete-icon\"\n            iconSize=\"m\"\n            role=\"button\"\n            tabIndex={0}\n            onClick={this.deleteItem.bind(this, record.id)}\n          />\n        </td>,\n      );\n    }\n    const trs = [\n      <tr {...{ 'data-test': 'table-row' }} className=\"row\" key={record.id}>\n        {tds}\n      </tr>,\n    ];\n    if (isExpanded) {\n      trs.push(\n        <tr className=\"exp\" key={`exp__${record.id}`}>\n          <td\n            colSpan={this.effectiveTableColumns().length}\n            className=\"expanded\"\n          >\n            <div>{this.renderExpandableSection(record)}</div>\n          </td>\n        </tr>,\n      );\n    }\n    return trs;\n  }\n\n  renderEmptyCell() {\n    return (\n      <tr>\n        <td className=\"empty-collection\">{this.props.emptyMessage}</td>\n      </tr>\n    );\n  }\n\n  renderTableBody() {\n    const data = Object.keys(this.state.collection).map(\n      k => this.state.collection[k],\n    );\n    const content = data.length\n      ? data.map(d => this.renderItem(d))\n      : this.renderEmptyCell();\n    return <tbody data-test=\"table-content-rows\">{content}</tbody>;\n  }\n\n  render() {\n    return (\n      <>\n        <CrudButtonWrapper>\n          {this.props.allowAddItem && (\n            <span className=\"m-t-10 m-r-10\">\n              <Button\n                buttonSize=\"small\"\n                buttonStyle=\"primary\"\n                onClick={this.onAddItem}\n                data-test=\"add-item-button\"\n              >\n                <i data-test=\"crud-add-table-item\" className=\"fa fa-plus\" />{' '}\n                {t('Add item')}\n              </Button>\n            </span>\n          )}\n        </CrudButtonWrapper>\n        <CrudTableWrapper\n          className=\"CRUD\"\n          stickyHeader={this.props.stickyHeader}\n        >\n          <table data-test=\"crud-table\" className=\"table\">\n            {this.renderHeaderRow()}\n            {this.renderTableBody()}\n          </table>\n        </CrudTableWrapper>\n      </>\n    );\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}