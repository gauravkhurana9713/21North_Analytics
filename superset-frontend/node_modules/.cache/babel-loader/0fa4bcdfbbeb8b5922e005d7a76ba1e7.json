{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _Object$entries from \"@babel/runtime-corejs3/core-js-stable/object/entries\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _someInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/some\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _debounce from \"lodash/debounce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, supersetTheme, css } from '@superset-ui/core';\n\nimport { Resizable } from 're-resizable';\n\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/core';\nimport { Tooltip } from 'src/common/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icon from 'src/components/Icon';\nimport {\ngetFromLocalStorage,\nsetInLocalStorage } from\n'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport cx from 'classnames';\nimport * as chartActions from 'src/chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as logActions from '../../logger/actions';\nimport {\nLOG_ACTIONS_MOUNT_EXPLORER,\nLOG_ACTIONS_CHANGE_EXPLORE_CONTROLS } from\n'../../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.number.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string };\n\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth });\n\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = _debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}__signature__(useWindowSize, \"useState{[size, setSize](getWindowSize())}\\nuseEffect{}\");\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = useDynamicPluginContext();\n  const dynamicPlugin = dynamicPluginContext.plugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.loading;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  const previousControls = usePrevious(props.controls);\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight ?\n  `${props.forcedHeight}px` :\n  `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width' };\n\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300 };\n\n\n  function addHistory({ isReplace = false, title } = {}) {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n    props.form_data,\n    props.standalone ? URL_PARAMS.standalone : null,\n    false);\n\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n      'Failed at altering browser history',\n      payload,\n      title,\n      longUrl);\n\n    }\n  }\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && _Object$keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n      formData,\n      false,\n      props.timeout,\n      props.chart.id);\n\n    }\n  }\n\n  function onQuery() {\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n  }\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (_sliceInstanceProperty(props)) {\n          props.actions.\n          saveSlice(props.form_data, {\n            action: 'overwrite',\n            slice_id: _sliceInstanceProperty(props).slice_id,\n            slice_name: _sliceInstanceProperty(props).slice_name,\n            add_to_dash: 'noSave',\n            goto_dash: false }).\n\n          then(({ data }) => {\n            window.location = _sliceInstanceProperty(data).slice_url;\n          });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {var _context;\n    const hasError = _someInstanceProperty(_context = _Object$values(props.controls)).call(_context,\n    (control) =>\n    control.validationErrors && control.validationErrors.length > 0);\n\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = () => {\n    props.actions.updateQueryFormData(\n    getFormDataFromControls(props.controls),\n    props.chart.id);\n\n    props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n    addHistory();\n  };\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {var _context2;\n      if (\n      props.controls.datasource && (\n      previousControls.datasource == null ||\n      props.controls.datasource.value !== previousControls.datasource.value))\n      {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = _filterInstanceProperty(_context2 = _Object$keys(props.controls)).call(_context2,\n      (key) =>\n      typeof previousControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      previousControls[key].value));\n\n\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = _someInstanceProperty(changedControlKeys).call(changedControlKeys,\n      key => props.controls[key].renderTrigger);\n\n      if (hasDisplayControlChanged) {\n        reRenderChart();\n      }\n    }\n  }, [props.controls, props.ownCurrentState]);\n\n  const chartIsStale = useMemo(() => {\n    if (previousControls) {var _context3;\n      const changedControlKeys = _filterInstanceProperty(_context3 = _Object$keys(props.controls)).call(_context3,\n      (key) =>\n      typeof previousControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      previousControls[key].value));\n\n\n\n      return _someInstanceProperty(changedControlKeys).call(changedControlKeys,\n      (key) =>\n      !props.controls[key].renderTrigger &&\n      !props.controls[key].dontRefreshOnChange);\n\n    }\n    return false;\n  }, [previousControls, props.controls]);\n\n  useEffect(() => {\n    if (props.ownCurrentState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownCurrentState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  function renderErrorMessage() {var _context4, _context5;\n    // Returns an error message as a node if any errors are in the store\n    const errors = _mapInstanceProperty(_context4 = _filterInstanceProperty(_context5 = _Object$entries(props.controls)).call(_context5,\n\n    ([, control]) =>\n    control.validationErrors && control.validationErrors.length > 0)).call(_context4,\n\n    ([key, control]) =>\n    ___EmotionJSX(\"div\", { key: key },\n    t('Control labeled '),\n    ___EmotionJSX(\"strong\", null, ` \"${control.label}\" `),\n    control.validationErrors.join('. ')));\n\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = ___EmotionJSX(\"div\", { style: { textAlign: 'left' } }, errors);\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      ___EmotionJSX(ExploreChartPanel, _extends({\n        width: width,\n        height: height },\n      props, {\n        errorMessage: renderErrorMessage(),\n        refreshOverlayVisible: chartIsStale,\n        addHistory: addHistory,\n        onQuery: onQuery })));\n\n\n  }\n\n  function getSidebarWidths(key) {\n    return getFromLocalStorage(key, defaultSidebarsWidth[key]);\n  }\n\n  function setSidebarWidths(key, dimension) {\n    const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n    setInLocalStorage(key, newDimension);\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    ___EmotionJSX(Styles, { id: \"explore-container\", height: height },\n    ___EmotionJSX(Global, {\n      styles: css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100vh;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        ` }),\n\n    showingModal &&\n    ___EmotionJSX(SaveModal, {\n      onHide: toggleModal,\n      actions: props.actions,\n      form_data: props.form_data,\n      sliceName: props.sliceName,\n      dashboardId: props.dashboardId }),\n\n\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.dataSourceWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.dataSourceWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.dataSourceWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className:\n      isCollapsed ? 'no-show' : 'explore-column data-source-selection' },\n\n\n    ___EmotionJSX(\"div\", { className: \"title-container\" },\n    ___EmotionJSX(\"span\", { className: \"horizont al-text\" }, t('Dataset')),\n    ___EmotionJSX(\"span\", {\n      role: \"button\",\n      tabIndex: 0,\n      className: \"action-button\",\n      onClick: toggleCollapse },\n\n    ___EmotionJSX(Icon, {\n      name: \"expand\",\n      color: supersetTheme.colors.primary.base,\n      className: \"collapse-icon\",\n      width: 16 }))),\n\n\n\n    ___EmotionJSX(DataSourcePanel, {\n      datasource: props.datasource,\n      controls: props.controls,\n      actions: props.actions })),\n\n\n    isCollapsed ?\n    ___EmotionJSX(\"div\", {\n      className: \"sidebar\",\n      onClick: toggleCollapse,\n      \"data-test\": \"open-datasource-tab\",\n      role: \"button\",\n      tabIndex: 0 },\n\n    ___EmotionJSX(\"span\", { role: \"button\", tabIndex: 0, className: \"action-button\" },\n    ___EmotionJSX(Tooltip, { title: t('Open Datasource tab') },\n    ___EmotionJSX(Icon, {\n      name: \"collapse\",\n      color: supersetTheme.colors.primary.base,\n      className: \"collapse-icon\",\n      width: 16 }))),\n\n\n\n    ___EmotionJSX(Icon, { name: \"dataset-physical\", width: 16 })) :\n\n    null,\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.controlsWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.controlsWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.controlsWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className: \"col-sm-3 explore-column controls-column\" },\n\n    ___EmotionJSX(QueryAndSaveBtns, {\n      canAdd: !!(props.can_add || props.can_overwrite),\n      onQuery: onQuery,\n      onSave: toggleModal,\n      onStop: onStop,\n      loading: props.chart.chartStatus === 'loading',\n      chartIsStale: chartIsStale,\n      errorMessage: renderErrorMessage(),\n      datasourceType: props.datasource_type }),\n\n    ___EmotionJSX(ConnectedControlPanelsContainer, {\n      actions: props.actions,\n      form_data: props.form_data,\n      controls: props.controls,\n      datasource_type: props.datasource_type,\n      isDatasourceMetaLoading: props.isDatasourceMetaLoading })),\n\n\n    ___EmotionJSX(\"div\", {\n      className: cx(\n      'main-explore-content',\n      isCollapsed ? 'col-sm-9' : 'col-sm-7') },\n\n\n    renderChartContainer())));\n\n\n\n}__signature__(ExploreViewContainer, \"useDynamicPluginContext{dynamicPluginContext}\\nusePrevious{wasDynamicPluginLoading}\\nusePrevious{previousControls}\\nuseWindowSize{windowSize}\\nuseState{[showingModal, setShowingModal](false)}\\nuseState{[isCollapsed, setIsCollapsed](false)}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseMemo{chartIsStale}\\nuseEffect{}\", () => [useDynamicPluginContext, usePrevious, usePrevious, useWindowSize]);\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {var _dataMask$ownFilters, _dataMask$ownFilters$, _dataMask$ownFilters2, _dataMask$ownFilters3;\n  const { explore, charts, impressionId, dataMask } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  form_data.extra_form_data = mergeExtraFormData(\n  { ...form_data.extra_form_data },\n  {\n    ...(dataMask == null ? void 0 : (_dataMask$ownFilters = dataMask.ownFilters) == null ? void 0 : (_dataMask$ownFilters$ = _dataMask$ownFilters[form_data.slice_id]) == null ? void 0 : _dataMask$ownFilters$.extraFormData) });\n\n\n  const chartKey = _Object$keys(charts)[0];\n  const chart = charts[chartKey];\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource ?\n    explore.datasource.column_formats :\n    null,\n    containerId: _sliceInstanceProperty(explore) ?\n    `slice-container-${_sliceInstanceProperty(explore).slice_id}` :\n    'slice-container',\n    isStarred: explore.isStarred,\n    slice: _sliceInstanceProperty(explore),\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownCurrentState: dataMask == null ? void 0 : (_dataMask$ownFilters2 = dataMask.ownFilters) == null ? void 0 : (_dataMask$ownFilters3 = _dataMask$ownFilters2[form_data.slice_id]) == null ? void 0 : _dataMask$ownFilters3.currentState,\n    impressionId };\n\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions };\n\n  return {\n    actions: bindActionCreators(actions, dispatch) };\n\n}const _default =\n\nconnect(\nmapStateToProps,\nmapDispatchToProps)(\nExploreViewContainer);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(getWindowSize, \"getWindowSize\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(useWindowSize, \"useWindowSize\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(ExploreViewContainer, \"ExploreViewContainer\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx"],"names":["React","useEffect","useMemo","useState","PropTypes","bindActionCreators","connect","styled","t","supersetTheme","css","Resizable","useDynamicPluginContext","Global","Tooltip","usePrevious","Icon","getFromLocalStorage","setInLocalStorage","URL_PARAMS","cx","chartActions","fetchDatasourceMetadata","chartPropShape","mergeExtraFormData","ExploreChartPanel","ConnectedControlPanelsContainer","SaveModal","QueryAndSaveBtns","DataSourcePanel","getExploreLongUrl","areObjectsEqual","getFormDataFromControls","exploreActions","saveModalActions","logActions","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","propTypes","height","string","width","actions","object","isRequired","datasource_type","dashboardId","number","isDatasourceMetaLoading","bool","chart","slice","sliceName","controls","forcedHeight","form_data","standalone","timeout","impressionId","vizType","Styles","div","theme","colors","grayscale","light5","light2","gridUnit","light4","light1","typography","sizes","s","primary","base","getWindowSize","window","innerHeight","innerWidth","useWindowSize","delayMs","size","setSize","onWindowResize","addEventListener","removeEventListener","ExploreViewContainer","props","dynamicPluginContext","dynamicPlugin","plugins","isDynamicPluginLoading","loading","wasDynamicPluginLoading","previousControls","windowSize","showingModal","setShowingModal","isCollapsed","setIsCollapsed","navHeight","storageKeys","controlsWidth","dataSourceWidth","defaultSidebarsWidth","controls_width","datasource_width","addHistory","isReplace","title","payload","longUrl","history","replaceState","pushState","e","console","warn","handlePopstate","formData","state","length","setExploreControls","postChartFormData","id","onQuery","triggerQuery","handleKeydown","event","controlOrCommand","ctrlKey","metaKey","isEnter","key","keyCode","isS","saveSlice","action","slice_id","slice_name","add_to_dash","goto_dash","then","data","location","slice_url","onStop","queryController","abort","toggleModal","toggleCollapse","logEvent","document","dynamicPluginControlsReady","hasError","control","validationErrors","reRenderChart","updateQueryFormData","renderTriggered","Date","getTime","datasource","value","changedControlKeys","hasDisplayControlChanged","renderTrigger","ownCurrentState","chartIsStale","dontRefreshOnChange","undefined","renderErrorMessage","errors","label","join","errorMessage","textAlign","renderChartContainer","getSidebarWidths","setSidebarWidths","dimension","newDimension","Number","evt","direction","ref","d","right","can_add","can_overwrite","chartStatus","mapStateToProps","explore","charts","dataMask","extra_form_data","ownFilters","extraFormData","chartKey","type","datasourceId","datasource_id","can_download","column_formats","containerId","isStarred","triggerRender","table_name","datasource_name","viz_type","forced_height","common","conf","SUPERSET_WEBSERVER_TIMEOUT","currentState","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, supersetTheme, css } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport { Resizable } from 're-resizable';\n\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/core';\nimport { Tooltip } from 'src/common/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icon from 'src/components/Icon';\nimport {\n  getFromLocalStorage,\n  setInLocalStorage,\n} from 'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport cx from 'classnames';\nimport * as chartActions from 'src/chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as logActions from '../../logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n} from '../../logger/LogUtils';\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.number.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n};\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth,\n});\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = useDynamicPluginContext();\n  const dynamicPlugin = dynamicPluginContext.plugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.loading;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  const previousControls = usePrevious(props.controls);\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight\n    ? `${props.forcedHeight}px`\n    : `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width',\n  };\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300,\n  };\n\n  function addHistory({ isReplace = false, title } = {}) {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n      props.form_data,\n      props.standalone ? URL_PARAMS.standalone : null,\n      false,\n    );\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        'Failed at altering browser history',\n        payload,\n        title,\n        longUrl,\n      );\n    }\n  }\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        false,\n        props.timeout,\n        props.chart.id,\n      );\n    }\n  }\n\n  function onQuery() {\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n  }\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (props.slice) {\n          props.actions\n            .saveSlice(props.form_data, {\n              action: 'overwrite',\n              slice_id: props.slice.slice_id,\n              slice_name: props.slice.slice_name,\n              add_to_dash: 'noSave',\n              goto_dash: false,\n            })\n            .then(({ data }) => {\n              window.location = data.slice.slice_url;\n            });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = () => {\n    props.actions.updateQueryFormData(\n      getFormDataFromControls(props.controls),\n      props.chart.id,\n    );\n    props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n    addHistory();\n  };\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {\n      if (\n        props.controls.datasource &&\n        (previousControls.datasource == null ||\n          props.controls.datasource.value !== previousControls.datasource.value)\n      ) {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = changedControlKeys.some(\n        key => props.controls[key].renderTrigger,\n      );\n      if (hasDisplayControlChanged) {\n        reRenderChart();\n      }\n    }\n  }, [props.controls, props.ownCurrentState]);\n\n  const chartIsStale = useMemo(() => {\n    if (previousControls) {\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      return changedControlKeys.some(\n        key =>\n          !props.controls[key].renderTrigger &&\n          !props.controls[key].dontRefreshOnChange,\n      );\n    }\n    return false;\n  }, [previousControls, props.controls]);\n\n  useEffect(() => {\n    if (props.ownCurrentState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownCurrentState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  function renderErrorMessage() {\n    // Returns an error message as a node if any errors are in the store\n    const errors = Object.entries(props.controls)\n      .filter(\n        ([, control]) =>\n          control.validationErrors && control.validationErrors.length > 0,\n      )\n      .map(([key, control]) => (\n        <div key={key}>\n          {t('Control labeled ')}\n          <strong>{` \"${control.label}\" `}</strong>\n          {control.validationErrors.join('. ')}\n        </div>\n      ));\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = <div style={{ textAlign: 'left' }}>{errors}</div>;\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      <ExploreChartPanel\n        width={width}\n        height={height}\n        {...props}\n        errorMessage={renderErrorMessage()}\n        refreshOverlayVisible={chartIsStale}\n        addHistory={addHistory}\n        onQuery={onQuery}\n      />\n    );\n  }\n\n  function getSidebarWidths(key) {\n    return getFromLocalStorage(key, defaultSidebarsWidth[key]);\n  }\n\n  function setSidebarWidths(key, dimension) {\n    const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n    setInLocalStorage(key, newDimension);\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    <Styles id=\"explore-container\" height={height}>\n      <Global\n        styles={css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100vh;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        `}\n      />\n      {showingModal && (\n        <SaveModal\n          onHide={toggleModal}\n          actions={props.actions}\n          form_data={props.form_data}\n          sliceName={props.sliceName}\n          dashboardId={props.dashboardId}\n        />\n      )}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.dataSourceWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.dataSourceWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.dataSourceWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className={\n          isCollapsed ? 'no-show' : 'explore-column data-source-selection'\n        }\n      >\n        <div className=\"title-container\">\n          <span className=\"horizont al-text\">{t('Dataset')}</span>\n          <span\n            role=\"button\"\n            tabIndex={0}\n            className=\"action-button\"\n            onClick={toggleCollapse}\n          >\n            <Icon\n              name=\"expand\"\n              color={supersetTheme.colors.primary.base}\n              className=\"collapse-icon\"\n              width={16}\n            />\n          </span>\n        </div>\n        <DataSourcePanel\n          datasource={props.datasource}\n          controls={props.controls}\n          actions={props.actions}\n        />\n      </Resizable>\n      {isCollapsed ? (\n        <div\n          className=\"sidebar\"\n          onClick={toggleCollapse}\n          data-test=\"open-datasource-tab\"\n          role=\"button\"\n          tabIndex={0}\n        >\n          <span role=\"button\" tabIndex={0} className=\"action-button\">\n            <Tooltip title={t('Open Datasource tab')}>\n              <Icon\n                name=\"collapse\"\n                color={supersetTheme.colors.primary.base}\n                className=\"collapse-icon\"\n                width={16}\n              />\n            </Tooltip>\n          </span>\n          <Icon name=\"dataset-physical\" width={16} />\n        </div>\n      ) : null}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.controlsWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.controlsWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.controlsWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className=\"col-sm-3 explore-column controls-column\"\n      >\n        <QueryAndSaveBtns\n          canAdd={!!(props.can_add || props.can_overwrite)}\n          onQuery={onQuery}\n          onSave={toggleModal}\n          onStop={onStop}\n          loading={props.chart.chartStatus === 'loading'}\n          chartIsStale={chartIsStale}\n          errorMessage={renderErrorMessage()}\n          datasourceType={props.datasource_type}\n        />\n        <ConnectedControlPanelsContainer\n          actions={props.actions}\n          form_data={props.form_data}\n          controls={props.controls}\n          datasource_type={props.datasource_type}\n          isDatasourceMetaLoading={props.isDatasourceMetaLoading}\n        />\n      </Resizable>\n      <div\n        className={cx(\n          'main-explore-content',\n          isCollapsed ? 'col-sm-9' : 'col-sm-7',\n        )}\n      >\n        {renderChartContainer()}\n      </div>\n    </Styles>\n  );\n}\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {\n  const { explore, charts, impressionId, dataMask } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  form_data.extra_form_data = mergeExtraFormData(\n    { ...form_data.extra_form_data },\n    {\n      ...dataMask?.ownFilters?.[form_data.slice_id]?.extraFormData,\n    },\n  );\n  const chartKey = Object.keys(charts)[0];\n  const chart = charts[chartKey];\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource\n      ? explore.datasource.column_formats\n      : null,\n    containerId: explore.slice\n      ? `slice-container-${explore.slice.slice_id}`\n      : 'slice-container',\n    isStarred: explore.isStarred,\n    slice: explore.slice,\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownCurrentState: dataMask?.ownFilters?.[form_data.slice_id]?.currentState,\n    impressionId,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions,\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(ExploreViewContainer);\n"]},"metadata":{},"sourceType":"module"}