{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _parseInt from \"@babel/runtime-corejs3/core-js-stable/parse-int\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport { styled, useTheme } from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport ChartContainer from 'src/chart/ChartContainer';\nimport {\ngetFromLocalStorage,\nsetInLocalStorage } from\n'src/utils/localStorageHelpers';\nimport ConnectedExploreChartHeader from './ExploreChartHeader';\nimport { DataTablesPane } from './DataTablesPane';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  addHistory: PropTypes.func,\n  onQuery: PropTypes.func,\n  can_overwrite: PropTypes.bool.isRequired,\n  can_download: PropTypes.bool.isRequired,\n  datasource: PropTypes.object,\n  column_formats: PropTypes.object,\n  containerId: PropTypes.string.isRequired,\n  height: PropTypes.string.isRequired,\n  width: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  table_name: PropTypes.string,\n  vizType: PropTypes.string.isRequired,\n  form_data: PropTypes.object,\n  ownCurrentState: PropTypes.object,\n  standalone: PropTypes.number,\n  timeout: PropTypes.number,\n  refreshOverlayVisible: PropTypes.bool,\n  chart: chartPropShape,\n  errorMessage: PropTypes.node,\n  triggerRender: PropTypes.bool };\n\n\nconst GUTTER_SIZE_FACTOR = 1.25;\n\nconst CHART_PANEL_PADDING = 30;\nconst HEADER_PADDING = 15;\n\nconst STORAGE_KEYS = {\n  sizes: 'chart_split_sizes' };\n\n\nconst INITIAL_SIZES = [90, 10];\nconst MIN_SIZES = [300, 50];\nconst DEFAULT_SOUTH_PANE_HEIGHT_PERCENT = 40;\n\nconst Styles = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  align-content: stretch;\n  overflow: auto;\n  box-shadow: none;\n  height: 100%;\n\n  & > div:last-of-type {\n    flex-basis: 100%;\n  }\n\n  .gutter {\n    border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    width: ${({ theme }) => theme.gridUnit * 9}px;\n    margin: ${({ theme }) => theme.gridUnit * GUTTER_SIZE_FACTOR}px auto;\n  }\n\n  .gutter.gutter-vertical {\n    cursor: row-resize;\n  }\n\n  .ant-collapse {\n    .ant-tabs {\n      height: 100%;\n      .ant-tabs-nav {\n        padding-left: ${({ theme }) => theme.gridUnit * 5}px;\n        margin: 0;\n      }\n      .ant-tabs-content-holder {\n        overflow: hidden;\n        .ant-tabs-content {\n          height: 100%;\n        }\n      }\n    }\n  }\n`;\n\nconst ExploreChartPanel = props => {\n  const theme = useTheme();\n  const gutterMargin = theme.gridUnit * GUTTER_SIZE_FACTOR;\n  const gutterHeight = theme.gridUnit * GUTTER_SIZE_FACTOR;\n\n  const { height: hHeight, ref: headerRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300 });\n\n  const { width: chartPanelWidth, ref: chartPanelRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300 });\n\n  const [splitSizes, setSplitSizes] = useState(\n  getFromLocalStorage(STORAGE_KEYS.sizes, INITIAL_SIZES));\n\n\n  const calcSectionHeight = useCallback(\n  percent => {\n    let headerHeight;\n    if (props.standalone) {\n      headerHeight = 0;\n    } else if (hHeight) {\n      headerHeight = hHeight + HEADER_PADDING;\n    } else {\n      headerHeight = 50;\n    }\n    const containerHeight = _parseInt(props.height, 10) - headerHeight;\n    return (\n      containerHeight * percent / 100 - (gutterHeight / 2 + gutterMargin));\n\n  },\n  [gutterHeight, gutterMargin, props.height, props.standalone, hHeight]);\n\n\n  const [tableSectionHeight, setTableSectionHeight] = useState(\n  calcSectionHeight(INITIAL_SIZES[1]));\n\n\n  const recalcPanelSizes = useCallback(\n  ([, southPercent]) => {\n    setTableSectionHeight(calcSectionHeight(southPercent));\n  },\n  [calcSectionHeight]);\n\n\n  useEffect(() => {\n    recalcPanelSizes(splitSizes);\n  }, [recalcPanelSizes, splitSizes]);\n\n  useEffect(() => {\n    setInLocalStorage(STORAGE_KEYS.sizes, splitSizes);\n  }, [splitSizes]);\n\n  const onDragEnd = sizes => {\n    setSplitSizes(sizes);\n  };\n\n  const onCollapseChange = openPanelName => {\n    let splitSizes;\n    if (!openPanelName) {\n      splitSizes = INITIAL_SIZES;\n    } else {\n      splitSizes = [\n      100 - DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n      DEFAULT_SOUTH_PANE_HEIGHT_PERCENT];\n\n    }\n    setSplitSizes(splitSizes);\n  };\n\n  const renderChart = useCallback(() => {\n    const { chart } = props;\n    const newHeight = calcSectionHeight(splitSizes[0]) - CHART_PANEL_PADDING;\n    const chartWidth = chartPanelWidth - CHART_PANEL_PADDING;\n    return (\n      chartWidth > 0 &&\n      ___EmotionJSX(ChartContainer, {\n        width: Math.floor(chartWidth),\n        height: newHeight,\n        ownCurrentState: props.ownCurrentState,\n        annotationData: chart.annotationData,\n        chartAlert: chart.chartAlert,\n        chartStackTrace: chart.chartStackTrace,\n        chartId: chart.id,\n        chartStatus: chart.chartStatus,\n        triggerRender: props.triggerRender,\n        datasource: props.datasource,\n        errorMessage: props.errorMessage,\n        formData: props.form_data,\n        onQuery: props.onQuery,\n        queriesResponse: chart.queriesResponse,\n        refreshOverlayVisible: props.refreshOverlayVisible,\n        setControlValue: props.actions.setControlValue,\n        timeout: props.timeout,\n        triggerQuery: chart.triggerQuery,\n        vizType: props.vizType }));\n\n\n\n  }, [calcSectionHeight, chartPanelWidth, props, splitSizes]);\n\n  const panelBody = useMemo(\n  () =>\n  ___EmotionJSX(\"div\", { className: \"panel-body\", ref: chartPanelRef },\n  renderChart()),\n\n\n  [chartPanelRef, renderChart]);\n\n\n  const standaloneChartBody = useMemo(\n  () => ___EmotionJSX(\"div\", { ref: chartPanelRef }, renderChart()),\n  [chartPanelRef, renderChart]);\n\n\n  if (props.standalone) {\n    // dom manipulation hack to get rid of the boostrap theme's body background\n    const standaloneClass = 'background-transparent';\n    const bodyClasses = document.body.className.split(' ');\n    if (!_includesInstanceProperty(bodyClasses).call(bodyClasses, standaloneClass)) {\n      document.body.className += ` ${standaloneClass}`;\n    }\n    return standaloneChartBody;\n  }\n\n  const header =\n  ___EmotionJSX(ConnectedExploreChartHeader, {\n    actions: props.actions,\n    addHistory: props.addHistory,\n    can_overwrite: props.can_overwrite,\n    can_download: props.can_download,\n    isStarred: props.isStarred,\n    slice: _sliceInstanceProperty(props),\n    sliceName: props.sliceName,\n    table_name: props.table_name,\n    form_data: props.form_data,\n    timeout: props.timeout,\n    chart: props.chart });\n\n\n\n  const elementStyle = (dimension, elementSize, gutterSize) => ({\n    [dimension]: `calc(${elementSize}% - ${gutterSize + gutterMargin}px)` });\n\n\n  return (\n    ___EmotionJSX(Styles, { className: \"panel panel-default chart-container\", ref: chartPanelRef },\n    ___EmotionJSX(\"div\", { className: \"panel-heading\", ref: headerRef },\n    header),\n\n    props.vizType === 'filter_box' ?\n    panelBody :\n\n    ___EmotionJSX(Split, {\n      sizes: splitSizes,\n      minSize: MIN_SIZES,\n      direction: \"vertical\",\n      gutterSize: gutterHeight,\n      onDragEnd: onDragEnd,\n      elementStyle: elementStyle },\n\n    panelBody,\n    ___EmotionJSX(DataTablesPane, {\n      queryFormData: props.chart.latestQueryFormData,\n      tableSectionHeight: tableSectionHeight,\n      onCollapseChange: onCollapseChange,\n      chartStatus: props.chart.chartStatus }))));\n\n\n\n\n\n};__signature__(ExploreChartPanel, \"useTheme{theme}\\nuseResizeDetector{{ height: hHeight, ref: headerRef }}\\nuseResizeDetector{{ width: chartPanelWidth, ref: chartPanelRef }}\\nuseState{[splitSizes, setSplitSizes](getFromLocalStorage(STORAGE_KEYS.sizes, INITIAL_SIZES))}\\nuseCallback{calcSectionHeight}\\nuseState{[tableSectionHeight, setTableSectionHeight](calcSectionHeight(INITIAL_SIZES[1]))}\\nuseCallback{recalcPanelSizes}\\nuseEffect{}\\nuseEffect{}\\nuseCallback{renderChart}\\nuseMemo{panelBody}\\nuseMemo{standaloneChartBody}\", () => [useTheme, useResizeDetector, useResizeDetector]);\n\nExploreChartPanel.propTypes = propTypes;const _default =\n\nExploreChartPanel;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(GUTTER_SIZE_FACTOR, \"GUTTER_SIZE_FACTOR\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(CHART_PANEL_PADDING, \"CHART_PANEL_PADDING\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(HEADER_PADDING, \"HEADER_PADDING\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(STORAGE_KEYS, \"STORAGE_KEYS\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(INITIAL_SIZES, \"INITIAL_SIZES\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(MIN_SIZES, \"MIN_SIZES\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(DEFAULT_SOUTH_PANE_HEIGHT_PERCENT, \"DEFAULT_SOUTH_PANE_HEIGHT_PERCENT\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(ExploreChartPanel, \"ExploreChartPanel\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/ExploreChartPanel.jsx"],"names":["React","useState","useEffect","useCallback","useMemo","PropTypes","Split","styled","useTheme","useResizeDetector","chartPropShape","ChartContainer","getFromLocalStorage","setInLocalStorage","ConnectedExploreChartHeader","DataTablesPane","propTypes","actions","object","isRequired","addHistory","func","onQuery","can_overwrite","bool","can_download","datasource","column_formats","containerId","string","height","width","isStarred","slice","sliceName","table_name","vizType","form_data","ownCurrentState","standalone","number","timeout","refreshOverlayVisible","chart","errorMessage","node","triggerRender","GUTTER_SIZE_FACTOR","CHART_PANEL_PADDING","HEADER_PADDING","STORAGE_KEYS","sizes","INITIAL_SIZES","MIN_SIZES","DEFAULT_SOUTH_PANE_HEIGHT_PERCENT","Styles","div","theme","colors","grayscale","light2","gridUnit","ExploreChartPanel","props","gutterMargin","gutterHeight","hHeight","ref","headerRef","refreshMode","refreshRate","chartPanelWidth","chartPanelRef","splitSizes","setSplitSizes","calcSectionHeight","percent","headerHeight","containerHeight","tableSectionHeight","setTableSectionHeight","recalcPanelSizes","southPercent","onDragEnd","onCollapseChange","openPanelName","renderChart","newHeight","chartWidth","Math","floor","annotationData","chartAlert","chartStackTrace","id","chartStatus","queriesResponse","setControlValue","triggerQuery","panelBody","standaloneChartBody","standaloneClass","bodyClasses","document","body","className","split","header","elementStyle","dimension","elementSize","gutterSize","latestQueryFormData"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport { styled, useTheme } from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport ChartContainer from 'src/chart/ChartContainer';\nimport {\n  getFromLocalStorage,\n  setInLocalStorage,\n} from 'src/utils/localStorageHelpers';\nimport ConnectedExploreChartHeader from './ExploreChartHeader';\nimport { DataTablesPane } from './DataTablesPane';\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  addHistory: PropTypes.func,\n  onQuery: PropTypes.func,\n  can_overwrite: PropTypes.bool.isRequired,\n  can_download: PropTypes.bool.isRequired,\n  datasource: PropTypes.object,\n  column_formats: PropTypes.object,\n  containerId: PropTypes.string.isRequired,\n  height: PropTypes.string.isRequired,\n  width: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  table_name: PropTypes.string,\n  vizType: PropTypes.string.isRequired,\n  form_data: PropTypes.object,\n  ownCurrentState: PropTypes.object,\n  standalone: PropTypes.number,\n  timeout: PropTypes.number,\n  refreshOverlayVisible: PropTypes.bool,\n  chart: chartPropShape,\n  errorMessage: PropTypes.node,\n  triggerRender: PropTypes.bool,\n};\n\nconst GUTTER_SIZE_FACTOR = 1.25;\n\nconst CHART_PANEL_PADDING = 30;\nconst HEADER_PADDING = 15;\n\nconst STORAGE_KEYS = {\n  sizes: 'chart_split_sizes',\n};\n\nconst INITIAL_SIZES = [90, 10];\nconst MIN_SIZES = [300, 50];\nconst DEFAULT_SOUTH_PANE_HEIGHT_PERCENT = 40;\n\nconst Styles = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  align-content: stretch;\n  overflow: auto;\n  box-shadow: none;\n  height: 100%;\n\n  & > div:last-of-type {\n    flex-basis: 100%;\n  }\n\n  .gutter {\n    border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    width: ${({ theme }) => theme.gridUnit * 9}px;\n    margin: ${({ theme }) => theme.gridUnit * GUTTER_SIZE_FACTOR}px auto;\n  }\n\n  .gutter.gutter-vertical {\n    cursor: row-resize;\n  }\n\n  .ant-collapse {\n    .ant-tabs {\n      height: 100%;\n      .ant-tabs-nav {\n        padding-left: ${({ theme }) => theme.gridUnit * 5}px;\n        margin: 0;\n      }\n      .ant-tabs-content-holder {\n        overflow: hidden;\n        .ant-tabs-content {\n          height: 100%;\n        }\n      }\n    }\n  }\n`;\n\nconst ExploreChartPanel = props => {\n  const theme = useTheme();\n  const gutterMargin = theme.gridUnit * GUTTER_SIZE_FACTOR;\n  const gutterHeight = theme.gridUnit * GUTTER_SIZE_FACTOR;\n\n  const { height: hHeight, ref: headerRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300,\n  });\n  const { width: chartPanelWidth, ref: chartPanelRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300,\n  });\n  const [splitSizes, setSplitSizes] = useState(\n    getFromLocalStorage(STORAGE_KEYS.sizes, INITIAL_SIZES),\n  );\n\n  const calcSectionHeight = useCallback(\n    percent => {\n      let headerHeight;\n      if (props.standalone) {\n        headerHeight = 0;\n      } else if (hHeight) {\n        headerHeight = hHeight + HEADER_PADDING;\n      } else {\n        headerHeight = 50;\n      }\n      const containerHeight = parseInt(props.height, 10) - headerHeight;\n      return (\n        (containerHeight * percent) / 100 - (gutterHeight / 2 + gutterMargin)\n      );\n    },\n    [gutterHeight, gutterMargin, props.height, props.standalone, hHeight],\n  );\n\n  const [tableSectionHeight, setTableSectionHeight] = useState(\n    calcSectionHeight(INITIAL_SIZES[1]),\n  );\n\n  const recalcPanelSizes = useCallback(\n    ([, southPercent]) => {\n      setTableSectionHeight(calcSectionHeight(southPercent));\n    },\n    [calcSectionHeight],\n  );\n\n  useEffect(() => {\n    recalcPanelSizes(splitSizes);\n  }, [recalcPanelSizes, splitSizes]);\n\n  useEffect(() => {\n    setInLocalStorage(STORAGE_KEYS.sizes, splitSizes);\n  }, [splitSizes]);\n\n  const onDragEnd = sizes => {\n    setSplitSizes(sizes);\n  };\n\n  const onCollapseChange = openPanelName => {\n    let splitSizes;\n    if (!openPanelName) {\n      splitSizes = INITIAL_SIZES;\n    } else {\n      splitSizes = [\n        100 - DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n        DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n      ];\n    }\n    setSplitSizes(splitSizes);\n  };\n\n  const renderChart = useCallback(() => {\n    const { chart } = props;\n    const newHeight = calcSectionHeight(splitSizes[0]) - CHART_PANEL_PADDING;\n    const chartWidth = chartPanelWidth - CHART_PANEL_PADDING;\n    return (\n      chartWidth > 0 && (\n        <ChartContainer\n          width={Math.floor(chartWidth)}\n          height={newHeight}\n          ownCurrentState={props.ownCurrentState}\n          annotationData={chart.annotationData}\n          chartAlert={chart.chartAlert}\n          chartStackTrace={chart.chartStackTrace}\n          chartId={chart.id}\n          chartStatus={chart.chartStatus}\n          triggerRender={props.triggerRender}\n          datasource={props.datasource}\n          errorMessage={props.errorMessage}\n          formData={props.form_data}\n          onQuery={props.onQuery}\n          queriesResponse={chart.queriesResponse}\n          refreshOverlayVisible={props.refreshOverlayVisible}\n          setControlValue={props.actions.setControlValue}\n          timeout={props.timeout}\n          triggerQuery={chart.triggerQuery}\n          vizType={props.vizType}\n        />\n      )\n    );\n  }, [calcSectionHeight, chartPanelWidth, props, splitSizes]);\n\n  const panelBody = useMemo(\n    () => (\n      <div className=\"panel-body\" ref={chartPanelRef}>\n        {renderChart()}\n      </div>\n    ),\n    [chartPanelRef, renderChart],\n  );\n\n  const standaloneChartBody = useMemo(\n    () => <div ref={chartPanelRef}>{renderChart()}</div>,\n    [chartPanelRef, renderChart],\n  );\n\n  if (props.standalone) {\n    // dom manipulation hack to get rid of the boostrap theme's body background\n    const standaloneClass = 'background-transparent';\n    const bodyClasses = document.body.className.split(' ');\n    if (!bodyClasses.includes(standaloneClass)) {\n      document.body.className += ` ${standaloneClass}`;\n    }\n    return standaloneChartBody;\n  }\n\n  const header = (\n    <ConnectedExploreChartHeader\n      actions={props.actions}\n      addHistory={props.addHistory}\n      can_overwrite={props.can_overwrite}\n      can_download={props.can_download}\n      isStarred={props.isStarred}\n      slice={props.slice}\n      sliceName={props.sliceName}\n      table_name={props.table_name}\n      form_data={props.form_data}\n      timeout={props.timeout}\n      chart={props.chart}\n    />\n  );\n\n  const elementStyle = (dimension, elementSize, gutterSize) => ({\n    [dimension]: `calc(${elementSize}% - ${gutterSize + gutterMargin}px)`,\n  });\n\n  return (\n    <Styles className=\"panel panel-default chart-container\" ref={chartPanelRef}>\n      <div className=\"panel-heading\" ref={headerRef}>\n        {header}\n      </div>\n      {props.vizType === 'filter_box' ? (\n        panelBody\n      ) : (\n        <Split\n          sizes={splitSizes}\n          minSize={MIN_SIZES}\n          direction=\"vertical\"\n          gutterSize={gutterHeight}\n          onDragEnd={onDragEnd}\n          elementStyle={elementStyle}\n        >\n          {panelBody}\n          <DataTablesPane\n            queryFormData={props.chart.latestQueryFormData}\n            tableSectionHeight={tableSectionHeight}\n            onCollapseChange={onCollapseChange}\n            chartStatus={props.chart.chartStatus}\n          />\n        </Split>\n      )}\n    </Styles>\n  );\n};\n\nExploreChartPanel.propTypes = propTypes;\n\nexport default ExploreChartPanel;\n"]},"metadata":{},"sourceType":"module"}