{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _entriesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/entries\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col, FormControl } from 'react-bootstrap';\nimport { Behavior, t, getChartMetadataRegistry } from '@superset-ui/core';\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport { Tooltip } from 'src/common/components/Tooltip';\nimport Modal from 'src/common/components/Modal';\nimport Label from 'src/components/Label';\nimport ControlHeader from '../ControlHeader';\nimport './VizTypeControl.less';\nimport { FeatureFlag, isFeatureEnabled } from '../../../featureFlags';import { jsx as ___EmotionJSX } from \"@emotion/core\";\n\nconst propTypes = {\n  description: PropTypes.string,\n  label: PropTypes.string,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string.isRequired,\n  labelType: PropTypes.string };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  labelType: 'default' };\n\n\nconst registry = getChartMetadataRegistry();\n\nconst IMAGE_PER_ROW = 6;\nconst DEFAULT_ORDER = [\n'line',\n'big_number',\n'table',\n'filter_box',\n'dist_bar',\n'area',\n'bar',\n'deck_polygon',\n'pie',\n'time_table',\n'pivot_table',\n'histogram',\n'big_number_total',\n'deck_scatter',\n'deck_hex',\n'time_pivot',\n'deck_arc',\n'heatmap',\n'deck_grid',\n'dual_line',\n'deck_screengrid',\n'line_multi',\n'treemap',\n'box_plot',\n'sunburst',\n'sankey',\n'word_cloud',\n'mapbox',\n'kepler',\n'cal_heatmap',\n'rose',\n'bubble',\n'deck_geojson',\n'horizon',\n'deck_multi',\n'compare',\n'partition',\n'event_flow',\n'deck_path',\n'graph_chart',\n'world_map',\n'paired_ttest',\n'para',\n'country_map'];\n\n\nconst typesWithDefaultOrder = new _Set(DEFAULT_ORDER);\n\nfunction VizSupportValidation({ vizType }) {\n  const state = useDynamicPluginContext();\n  if (state.loading || registry.has(vizType)) {\n    return null;\n  }\n  return (\n    ___EmotionJSX(\"div\", { className: \"text-danger\" },\n    ___EmotionJSX(\"i\", { className: \"fa fa-exclamation-circle text-danger\" }), ' ',\n    ___EmotionJSX(\"small\", null, t('This visualization type is not supported.'))));\n\n\n}__signature__(VizSupportValidation, \"useDynamicPluginContext{state}\", () => [useDynamicPluginContext]);\n\nconst VizTypeControl = props => {var _context, _context2, _context3, _context4, _context5, _context6;\n  const [showModal, setShowModal] = useState(false);\n  const [filter, setFilter] = useState('');\n  const searchRef = useRef(null);\n\n  useEffect(() => {\n    if (showModal) {var _searchRef$current;\n      searchRef == null ? void 0 : (_searchRef$current = searchRef.current) == null ? void 0 : _searchRef$current.focus();\n    }\n  }, [showModal]);\n\n  const onChange = vizType => {\n    props.onChange(vizType);\n    setShowModal(false);\n  };\n\n  const toggleModal = () => {\n    setShowModal(prevState => !prevState);\n  };\n\n  const changeSearch = event => {\n    setFilter(event.target.value);\n  };\n\n  const focusSearch = () => {\n    if (searchRef) {\n      searchRef.focus();\n    }\n  };\n\n  const renderItem = entry => {\n    const { value } = props;\n    const { key, value: type } = entry;\n    const isSelected = key === value;\n\n    return (\n      ___EmotionJSX(\"div\", {\n        role: \"button\",\n        tabIndex: 0,\n        className: `viztype-selector-container ${isSelected ? 'selected' : ''}`,\n        onClick: () => onChange(key) },\n\n      ___EmotionJSX(\"img\", {\n        alt: type.name,\n        width: \"100%\",\n        className: `viztype-selector ${isSelected ? 'selected' : ''}`,\n        src: type.thumbnail }),\n\n      ___EmotionJSX(\"div\", { className: \"viztype-label\", \"data-test\": \"viztype-label\" },\n      type.name)));\n\n\n\n  };\n\n  const { value, labelType } = props;\n  const filterString = filter.toLowerCase();\n\n  const filteredTypes = _filterInstanceProperty(_context = _concatInstanceProperty(_context2 = _mapInstanceProperty(_context3 = _filterInstanceProperty(_context4 = _filterInstanceProperty(DEFAULT_ORDER).call(DEFAULT_ORDER, type => registry.has(type))).call(_context4,\n  type => {var _registry$get;\n    const behaviors = ((_registry$get = registry.get(type)) == null ? void 0 : _registry$get.behaviors) || [];\n    return (\n      isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n      _includesInstanceProperty(behaviors).call(behaviors, Behavior.CROSS_FILTER) ||\n      !behaviors.length);\n\n  })).call(_context3,\n  type => ({\n    key: type,\n    value: registry.get(type) }))).call(_context2,\n\n\n  _filterInstanceProperty(_context5 = _filterInstanceProperty(_context6 = _entriesInstanceProperty(registry).call(registry)).call(_context6,\n\n  entry => {var _entry$value;\n    const behaviors = ((_entry$value = entry.value) == null ? void 0 : _entry$value.behaviors) || [];\n    return (\n      isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n      _includesInstanceProperty(behaviors).call(behaviors, Behavior.CROSS_FILTER) ||\n      !behaviors.length);\n\n  })).call(_context5,\n  ({ key }) => !typesWithDefaultOrder.has(key)))).call(_context,\n\n  entry => {var _context7;return _includesInstanceProperty(_context7 = entry.value.name.toLowerCase()).call(_context7, filterString);});\n\n  const rows = [];\n  for (let i = 0; i <= filteredTypes.length; i += IMAGE_PER_ROW) {var _context8;\n    rows.push(\n    ___EmotionJSX(Row, { \"data-test\": \"viz-row\", key: `row-${i}` },\n    _mapInstanceProperty(_context8 = _sliceInstanceProperty(filteredTypes).call(filteredTypes, i, i + IMAGE_PER_ROW)).call(_context8, (entry) =>\n    ___EmotionJSX(Col, { md: 12 / IMAGE_PER_ROW, key: `grid-col-${entry.key}` },\n    renderItem(entry)))));\n\n\n\n\n  }\n\n  return (\n    ___EmotionJSX(\"div\", null,\n    ___EmotionJSX(ControlHeader, props),\n    ___EmotionJSX(Tooltip, {\n      id: \"error-tooltip\",\n      placement: \"right\",\n      title: t('Click to change visualization type') },\n\n    ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Label, {\n      onClick: toggleModal,\n      type: labelType,\n      \"data-test\": \"visualization-type\" },\n\n    registry.has(value) ? registry.get(value).name : `${value}`),\n\n    ___EmotionJSX(VizSupportValidation, { vizType: value }))),\n\n\n    ___EmotionJSX(Modal, {\n      show: showModal,\n      onHide: toggleModal,\n      onEnter: focusSearch,\n      title: t('Select a visualization type'),\n      responsive: true,\n      hideFooter: true,\n      forceRender: true },\n\n    ___EmotionJSX(\"div\", { className: \"viztype-control-search-box\" },\n    ___EmotionJSX(FormControl, {\n      inputRef: ref => {\n        searchRef.current = ref;\n      },\n      type: \"text\",\n      value: filter,\n      placeholder: t('Search'),\n      onChange: changeSearch })),\n\n\n    rows)));\n\n\n\n};__signature__(VizTypeControl, \"useState{[showModal, setShowModal](false)}\\nuseState{[filter, setFilter]('')}\\nuseRef{searchRef}\\nuseEffect{}\");\n\nVizTypeControl.propTypes = propTypes;\nVizTypeControl.defaultProps = defaultProps;const _default =\n\nVizTypeControl;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");reactHotLoader.register(registry, \"registry\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");reactHotLoader.register(IMAGE_PER_ROW, \"IMAGE_PER_ROW\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");reactHotLoader.register(DEFAULT_ORDER, \"DEFAULT_ORDER\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");reactHotLoader.register(typesWithDefaultOrder, \"typesWithDefaultOrder\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");reactHotLoader.register(VizSupportValidation, \"VizSupportValidation\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");reactHotLoader.register(VizTypeControl, \"VizTypeControl\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/VizTypeControl.jsx"],"names":["React","useEffect","useRef","useState","PropTypes","Row","Col","FormControl","Behavior","t","getChartMetadataRegistry","useDynamicPluginContext","Tooltip","Modal","Label","ControlHeader","FeatureFlag","isFeatureEnabled","propTypes","description","string","label","name","isRequired","onChange","func","value","labelType","defaultProps","registry","IMAGE_PER_ROW","DEFAULT_ORDER","typesWithDefaultOrder","VizSupportValidation","vizType","state","loading","has","VizTypeControl","props","showModal","setShowModal","filter","setFilter","searchRef","current","focus","toggleModal","prevState","changeSearch","event","target","focusSearch","renderItem","entry","key","type","isSelected","thumbnail","filterString","toLowerCase","filteredTypes","behaviors","get","DASHBOARD_CROSS_FILTERS","CROSS_FILTER","length","rows","i","push","ref"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col, FormControl } from 'react-bootstrap';\nimport { Behavior, t, getChartMetadataRegistry } from '@superset-ui/core';\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport { Tooltip } from 'src/common/components/Tooltip';\nimport Modal from 'src/common/components/Modal';\nimport Label from 'src/components/Label';\nimport ControlHeader from '../ControlHeader';\nimport './VizTypeControl.less';\nimport { FeatureFlag, isFeatureEnabled } from '../../../featureFlags';\n\nconst propTypes = {\n  description: PropTypes.string,\n  label: PropTypes.string,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string.isRequired,\n  labelType: PropTypes.string,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  labelType: 'default',\n};\n\nconst registry = getChartMetadataRegistry();\n\nconst IMAGE_PER_ROW = 6;\nconst DEFAULT_ORDER = [\n  'line',\n  'big_number',\n  'table',\n  'filter_box',\n  'dist_bar',\n  'area',\n  'bar',\n  'deck_polygon',\n  'pie',\n  'time_table',\n  'pivot_table',\n  'histogram',\n  'big_number_total',\n  'deck_scatter',\n  'deck_hex',\n  'time_pivot',\n  'deck_arc',\n  'heatmap',\n  'deck_grid',\n  'dual_line',\n  'deck_screengrid',\n  'line_multi',\n  'treemap',\n  'box_plot',\n  'sunburst',\n  'sankey',\n  'word_cloud',\n  'mapbox',\n  'kepler',\n  'cal_heatmap',\n  'rose',\n  'bubble',\n  'deck_geojson',\n  'horizon',\n  'deck_multi',\n  'compare',\n  'partition',\n  'event_flow',\n  'deck_path',\n  'graph_chart',\n  'world_map',\n  'paired_ttest',\n  'para',\n  'country_map',\n];\n\nconst typesWithDefaultOrder = new Set(DEFAULT_ORDER);\n\nfunction VizSupportValidation({ vizType }) {\n  const state = useDynamicPluginContext();\n  if (state.loading || registry.has(vizType)) {\n    return null;\n  }\n  return (\n    <div className=\"text-danger\">\n      <i className=\"fa fa-exclamation-circle text-danger\" />{' '}\n      <small>{t('This visualization type is not supported.')}</small>\n    </div>\n  );\n}\n\nconst VizTypeControl = props => {\n  const [showModal, setShowModal] = useState(false);\n  const [filter, setFilter] = useState('');\n  const searchRef = useRef(null);\n\n  useEffect(() => {\n    if (showModal) {\n      searchRef?.current?.focus();\n    }\n  }, [showModal]);\n\n  const onChange = vizType => {\n    props.onChange(vizType);\n    setShowModal(false);\n  };\n\n  const toggleModal = () => {\n    setShowModal(prevState => !prevState);\n  };\n\n  const changeSearch = event => {\n    setFilter(event.target.value);\n  };\n\n  const focusSearch = () => {\n    if (searchRef) {\n      searchRef.focus();\n    }\n  };\n\n  const renderItem = entry => {\n    const { value } = props;\n    const { key, value: type } = entry;\n    const isSelected = key === value;\n\n    return (\n      <div\n        role=\"button\"\n        tabIndex={0}\n        className={`viztype-selector-container ${isSelected ? 'selected' : ''}`}\n        onClick={() => onChange(key)}\n      >\n        <img\n          alt={type.name}\n          width=\"100%\"\n          className={`viztype-selector ${isSelected ? 'selected' : ''}`}\n          src={type.thumbnail}\n        />\n        <div className=\"viztype-label\" data-test=\"viztype-label\">\n          {type.name}\n        </div>\n      </div>\n    );\n  };\n\n  const { value, labelType } = props;\n  const filterString = filter.toLowerCase();\n\n  const filteredTypes = DEFAULT_ORDER.filter(type => registry.has(type))\n    .filter(type => {\n      const behaviors = registry.get(type)?.behaviors || [];\n      return (\n        (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n          behaviors.includes(Behavior.CROSS_FILTER)) ||\n        !behaviors.length\n      );\n    })\n    .map(type => ({\n      key: type,\n      value: registry.get(type),\n    }))\n    .concat(\n      registry\n        .entries()\n        .filter(entry => {\n          const behaviors = entry.value?.behaviors || [];\n          return (\n            (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n              behaviors.includes(Behavior.CROSS_FILTER)) ||\n            !behaviors.length\n          );\n        })\n        .filter(({ key }) => !typesWithDefaultOrder.has(key)),\n    )\n    .filter(entry => entry.value.name.toLowerCase().includes(filterString));\n\n  const rows = [];\n  for (let i = 0; i <= filteredTypes.length; i += IMAGE_PER_ROW) {\n    rows.push(\n      <Row data-test=\"viz-row\" key={`row-${i}`}>\n        {filteredTypes.slice(i, i + IMAGE_PER_ROW).map(entry => (\n          <Col md={12 / IMAGE_PER_ROW} key={`grid-col-${entry.key}`}>\n            {renderItem(entry)}\n          </Col>\n        ))}\n      </Row>,\n    );\n  }\n\n  return (\n    <div>\n      <ControlHeader {...props} />\n      <Tooltip\n        id=\"error-tooltip\"\n        placement=\"right\"\n        title={t('Click to change visualization type')}\n      >\n        <>\n          <Label\n            onClick={toggleModal}\n            type={labelType}\n            data-test=\"visualization-type\"\n          >\n            {registry.has(value) ? registry.get(value).name : `${value}`}\n          </Label>\n          <VizSupportValidation vizType={value} />\n        </>\n      </Tooltip>\n      <Modal\n        show={showModal}\n        onHide={toggleModal}\n        onEnter={focusSearch}\n        title={t('Select a visualization type')}\n        responsive\n        hideFooter\n        forceRender\n      >\n        <div className=\"viztype-control-search-box\">\n          <FormControl\n            inputRef={ref => {\n              searchRef.current = ref;\n            }}\n            type=\"text\"\n            value={filter}\n            placeholder={t('Search')}\n            onChange={changeSearch}\n          />\n        </div>\n        {rows}\n      </Modal>\n    </div>\n  );\n};\n\nVizTypeControl.propTypes = propTypes;\nVizTypeControl.defaultProps = defaultProps;\n\nexport default VizTypeControl;\n"]},"metadata":{},"sourceType":"module"}